/**
 * skylark-data-files - The skylark file system library
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,e){var r=e.define,require=e.require,i="function"==typeof r&&r.amd,n=!i&&"undefined"!=typeof exports;if(!i&&!r){var s={};r=e.define=function(t,e,r){"function"==typeof r?(s[t]={factory:r,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var r=e.split("/"),i=t.split("/");r.pop();for(var n=0;n<i.length;n++)"."!=i[n]&&(".."==i[n]?r.pop():r.push(i[n]));return r.join("/")}(e,t)}),resolved:!1,exports:null},require(t)):s[t]={factory:null,resolved:!0,exports:r}},require=e.require=function(t){if(!s.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var module=s[t];if(!module.resolved){var r=[];module.deps.forEach(function(t){r.push(require(t))}),module.exports=module.factory.apply(e,r)||null,module.resolved=!0}return module.exports}}if(!r)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,require){t("skylark-data-files/files",["skylark-langx-ns"],function(t){return t.attach("data.files",{providers:{}})}),t("skylark-data-files/action-type",["./files"],function(t){"use strict";var e;return function(t){t[t.NOP=0]="NOP",t[t.THROW_EXCEPTION=1]="THROW_EXCEPTION",t[t.TRUNCATE_FILE=2]="TRUNCATE_FILE",t[t.CREATE_FILE=3]="CREATE_FILE"}(e||(e={})),t.ActionType=e}),t("skylark-data-files/error-codes",["./files"],function(t){"use strict";var e;return function(t){t[t.EPERM=1]="EPERM",t[t.ENOENT=2]="ENOENT",t[t.EIO=5]="EIO",t[t.EBADF=9]="EBADF",t[t.EACCES=13]="EACCES",t[t.EBUSY=16]="EBUSY",t[t.EEXIST=17]="EEXIST",t[t.ENOTDIR=20]="ENOTDIR",t[t.EISDIR=21]="EISDIR",t[t.EINVAL=22]="EINVAL",t[t.EFBIG=27]="EFBIG",t[t.ENOSPC=28]="ENOSPC",t[t.EROFS=30]="EROFS",t[t.ENOTEMPTY=39]="ENOTEMPTY",t[t.ENOTSUP=95]="ENOTSUP"}(e||(e={})),t.ErrorCodes=e}),t("skylark-langx-binary/base64",[],function(){"use strict";for(var exports={byteLength:function(t){var e=o(t),r=e[0],i=e[1];return 3*(r+i)/4-i},toByteArray:function(t){var i,n,s=o(t),a=s[0],c=s[1],l=new r(function(t,e,r){return 3*(e+r)/4-r}(0,a,c)),h=0,u=c>0?a-4:a;for(n=0;n<u;n+=4)i=e[t.charCodeAt(n)]<<18|e[t.charCodeAt(n+1)]<<12|e[t.charCodeAt(n+2)]<<6|e[t.charCodeAt(n+3)],l[h++]=i>>16&255,l[h++]=i>>8&255,l[h++]=255&i;2===c&&(i=e[t.charCodeAt(n)]<<2|e[t.charCodeAt(n+1)]>>4,l[h++]=255&i);1===c&&(i=e[t.charCodeAt(n)]<<10|e[t.charCodeAt(n+1)]<<4|e[t.charCodeAt(n+2)]>>2,l[h++]=i>>8&255,l[h++]=255&i);return l},fromByteArray:function(e){for(var r,i=e.length,n=i%3,s=[],o=0,c=i-n;o<c;o+=16383)s.push(a(e,o,o+16383>c?c:o+16383));1===n?(r=e[i-1],s.push(t[r>>2]+t[r<<4&63]+"==")):2===n&&(r=(e[i-2]<<8)+e[i-1],s.push(t[r>>10]+t[r>>4&63]+t[r<<2&63]+"="));return s.join("")}},t=[],e=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,s=i.length;n<s;++n)t[n]=i[n],e[i.charCodeAt(n)]=n;function o(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");-1===r&&(r=e);var i=r===e?0:4-r%4;return[r,i]}function a(e,r,i){for(var n,s,o=[],a=r;a<i;a+=3)n=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(t[(s=n)>>18&63]+t[s>>12&63]+t[s>>6&63]+t[63&s]);return o.join("")}return e["-".charCodeAt(0)]=62,e["_".charCodeAt(0)]=63,exports}),t("skylark-langx-binary/ieee754",[],function(){"use strict";var exports={read:function(t,e,r,i,n){var s,o,a=8*n-i-1,c=(1<<a)-1,l=c>>1,h=-7,u=r?n-1:0,f=r?-1:1,d=t[e+u];for(u+=f,s=d&(1<<-h)-1,d>>=-h,h+=a;h>0;s=256*s+t[e+u],u+=f,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=i;h>0;o=256*o+t[e+u],u+=f,h-=8);if(0===s)s=1-l;else{if(s===c)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,i),s-=l}return(d?-1:1)*o*Math.pow(2,s-i)},write:function(t,e,r,i,n,s){var o,a,c,l=8*s-n-1,h=(1<<l)-1,u=h>>1,f=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:s-1,y=i?1:-1,p=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),(e+=o+u>=1?f/c:f*Math.pow(2,1-u))*c>=2&&(o++,c/=2),o+u>=h?(a=0,o=h):o+u>=1?(a=(e*c-1)*Math.pow(2,n),o+=u):(a=e*Math.pow(2,u-1)*Math.pow(2,n),o=0));n>=8;t[r+d]=255&a,d+=y,a/=256,n-=8);for(o=o<<n|a,l+=n;l>0;t[r+d]=255&o,d+=y,o/=256,l-=8);t[r+d-y]|=128*p}};return exports}),t("skylark-langx-binary/buffer",["./binary","./base64","./ieee754"],function(t,e,r){"use strict";s.INSPECT_MAX_BYTES=50;var i=2147483647;function n(t){if(t>i)throw new RangeError("Invalid typed array length");var e=new Uint8Array(t);return e.__proto__=s.prototype,e}function s(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return c(t)}return o(t,e,r)}function o(t,e,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return C(t)||t&&C(t.buffer)?function(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');var i;i=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r);return i.__proto__=s.prototype,i}(t,e,r):"string"==typeof t?function(t,e){"string"==typeof e&&""!==e||(e="utf8");if(!s.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var r=0|u(t,e),i=n(r),o=i.write(t,e);o!==r&&(i=i.slice(0,o));return i}(t,e):function(t){if(s.isBuffer(t)){var e=0|h(t.length),r=n(e);return 0===r.length?r:(t.copy(r,0,0,e),r)}if(t){if(ArrayBuffer.isView(t)||"length"in t)return"number"!=typeof t.length||M(t.length)?n(0):l(t);if("Buffer"===t.type&&Array.isArray(t.data))return l(t.data)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object.")}(t)}function a(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('"size" argument must not be negative')}function c(t){return a(t),n(t<0?0:0|h(t))}function l(t){for(var e=t.length<0?0:0|h(t.length),r=n(e),i=0;i<e;i+=1)r[i]=255&t[i];return r}function h(t){if(t>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return 0|t}function u(t,e){if(s.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||C(t))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return R(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return B(t).length;default:if(i)return R(t).length;e=(""+e).toLowerCase(),i=!0}}function f(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function d(t,e,r,i,n){if(0===t.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),M(r=+r)&&(r=n?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(n)return-1;r=t.length-1}else if(r<0){if(!n)return-1;r=0}if("string"==typeof e&&(e=s.from(e,i)),s.isBuffer(e))return 0===e.length?-1:y(t,e,r,i,n);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):y(t,[e],r,i,n);throw new TypeError("val must be string, number or Buffer")}function y(t,e,r,i,n){var s,o=1,a=t.length,c=e.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return-1;o=2,a/=2,c/=2,r/=2}function l(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(n){var h=-1;for(s=r;s<a;s++)if(l(t,s)===l(e,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===c)return h*o}else-1!==h&&(s-=s-h),h=-1}else for(r+c>a&&(r=a-c),s=r;s>=0;s--){for(var u=!0,f=0;f<c;f++)if(l(t,s+f)!==l(e,f)){u=!1;break}if(u)return s}return-1}function p(t,e,r,i){r=Number(r)||0;var n=t.length-r;i?(i=Number(i))>n&&(i=n):i=n;var s=e.length;i>s/2&&(i=s/2);for(var o=0;o<i;++o){var a=parseInt(e.substr(2*o,2),16);if(M(a))return o;t[r+o]=a}return o}function w(t,e,r,i){return U(R(e,t.length-r),t,r,i)}function g(t,e,r,i){return U(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,i)}function m(t,e,r,i){return g(t,e,r,i)}function E(t,e,r,i){return U(B(e),t,r,i)}function S(t,e,r,i){return U(function(t,e){for(var r,i,n,s=[],o=0;o<t.length&&!((e-=2)<0);++o)r=t.charCodeAt(o),i=r>>8,n=r%256,s.push(n),s.push(i);return s}(e,t.length-r),t,r,i)}function b(t,r,i){return 0===r&&i===t.length?e.fromByteArray(t):e.fromByteArray(t.slice(r,i))}function _(t,e,r){r=Math.min(t.length,r);for(var i=[],n=e;n<r;){var s,o,a,c,l=t[n],h=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u<=r)switch(u){case 1:l<128&&(h=l);break;case 2:128==(192&(s=t[n+1]))&&(c=(31&l)<<6|63&s)>127&&(h=c);break;case 3:s=t[n+1],o=t[n+2],128==(192&s)&&128==(192&o)&&(c=(15&l)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(h=c);break;case 4:s=t[n+1],o=t[n+2],a=t[n+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(c=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(h=c)}null===h?(h=65533,u=1):h>65535&&(h-=65536,i.push(h>>>10&1023|55296),h=56320|1023&h),i.push(h),n+=u}return function(t){var e=t.length;if(e<=k)return String.fromCharCode.apply(String,t);var r="",i=0;for(;i<e;)r+=String.fromCharCode.apply(String,t.slice(i,i+=k));return r}(i)}s.kMaxLength=i,s.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{get:function(){if(this instanceof s)return this.buffer}}),Object.defineProperty(s.prototype,"offset",{get:function(){if(this instanceof s)return this.byteOffset}}),"undefined"!=typeof Symbol&&Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),s.poolSize=8192,s.from=function(t,e,r){return o(t,e,r)},s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,s.alloc=function(t,e,r){return function(t,e,r){if(a(t),t<=0)return n(t);if(void 0!==e)return"string"==typeof r?n(t).fill(e,r):n(t).fill(e);return n(t)}(t,e,r)},s.allocUnsafe=function(t){return c(t)},s.allocUnsafeSlow=function(t){return c(t)},s.isBuffer=function(t){return null!=t&&!0===t._isBuffer},s.compare=function(t,e){if(!s.isBuffer(t)||!s.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,i=e.length,n=0,o=Math.min(r,i);n<o;++n)if(t[n]!==e[n]){r=t[n],i=e[n];break}return r<i?-1:i<r?1:0},s.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return s.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var i=s.allocUnsafe(e),n=0;for(r=0;r<t.length;++r){var o=t[r];if(ArrayBuffer.isView(o)&&(o=s.from(o)),!s.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,n),n+=o.length}return i},s.byteLength=u,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)f(this,e,e+1);return this},s.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)f(this,e,e+3),f(this,e+1,e+2);return this},s.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)f(this,e,e+7),f(this,e+1,e+6),f(this,e+2,e+5),f(this,e+3,e+4);return this},s.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?_(this,0,t):function(t,e,r){var i=!1;(void 0===e||e<0)&&(e=0);if(e>this.length)return"";(void 0===r||r>this.length)&&(r=this.length);if(r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";t||(t="utf8");for(;;)switch(t){case"hex":return N(this,e,r);case"utf8":case"utf-8":return _(this,e,r);case"ascii":return v(this,e,r);case"latin1":case"binary":return I(this,e,r);case"base64":return b(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,e,r);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(t){if(!s.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===s.compare(this,t)},s.prototype.inspect=function(){var t="",e=s.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},s.prototype.compare=function(t,e,r,i,n){if(!s.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),e<0||r>t.length||i<0||n>this.length)throw new RangeError("out of range index");if(i>=n&&e>=r)return 0;if(i>=n)return-1;if(e>=r)return 1;if(e>>>=0,r>>>=0,i>>>=0,n>>>=0,this===t)return 0;for(var o=n-i,a=r-e,c=Math.min(o,a),l=this.slice(i,n),h=t.slice(e,r),u=0;u<c;++u)if(l[u]!==h[u]){o=l[u],a=h[u];break}return o<a?-1:a<o?1:0},s.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},s.prototype.indexOf=function(t,e,r){return d(this,t,e,r,!0)},s.prototype.lastIndexOf=function(t,e,r){return d(this,t,e,r,!1)},s.prototype.write=function(t,e,r,i){if(void 0===e)i="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)i=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}var n=this.length-e;if((void 0===r||r>n)&&(r=n),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var s=!1;;)switch(i){case"hex":return p(this,t,e,r);case"utf8":case"utf-8":return w(this,t,e,r);case"ascii":return g(this,t,e,r);case"latin1":case"binary":return m(this,t,e,r);case"base64":return E(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,t,e,r);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function v(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n)i+=String.fromCharCode(127&t[n]);return i}function I(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n)i+=String.fromCharCode(t[n]);return i}function N(t,e,r){var i=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>i)&&(r=i);for(var n="",s=e;s<r;++s)n+=L(t[s]);return n}function O(t,e,r){for(var i=t.slice(e,r),n="",s=0;s<i.length;s+=2)n+=String.fromCharCode(i[s]+256*i[s+1]);return n}function T(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function F(t,e,r,i,n,o){if(!s.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<o)throw new RangeError('"value" argument is out of bounds');if(r+i>t.length)throw new RangeError("Index out of range")}function x(t,e,r,i,n,s){if(r+i>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(t,e,i,n,s){return e=+e,i>>>=0,s||x(t,e,i,4,3.4028234663852886e38,-3.4028234663852886e38),r.write(t,e,i,n,23,4),i+4}function A(t,e,i,n,s){return e=+e,i>>>=0,s||x(t,e,i,8,1.7976931348623157e308,-1.7976931348623157e308),r.write(t,e,i,n,52,8),i+8}s.prototype.slice=function(t,e){var r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);var i=this.subarray(t,e);return i.__proto__=s.prototype,i},s.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||T(t,e,this.length);for(var i=this[t],n=1,s=0;++s<e&&(n*=256);)i+=this[t+s]*n;return i},s.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||T(t,e,this.length);for(var i=this[t+--e],n=1;e>0&&(n*=256);)i+=this[t+--e]*n;return i},s.prototype.readUInt8=function(t,e){return t>>>=0,e||T(t,1,this.length),this[t]},s.prototype.readUInt16LE=function(t,e){return t>>>=0,e||T(t,2,this.length),this[t]|this[t+1]<<8},s.prototype.readUInt16BE=function(t,e){return t>>>=0,e||T(t,2,this.length),this[t]<<8|this[t+1]},s.prototype.readUInt32LE=function(t,e){return t>>>=0,e||T(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},s.prototype.readUInt32BE=function(t,e){return t>>>=0,e||T(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},s.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||T(t,e,this.length);for(var i=this[t],n=1,s=0;++s<e&&(n*=256);)i+=this[t+s]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*e)),i},s.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||T(t,e,this.length);for(var i=e,n=1,s=this[t+--i];i>0&&(n*=256);)s+=this[t+--i]*n;return s>=(n*=128)&&(s-=Math.pow(2,8*e)),s},s.prototype.readInt8=function(t,e){return t>>>=0,e||T(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},s.prototype.readInt16LE=function(t,e){t>>>=0,e||T(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt16BE=function(t,e){t>>>=0,e||T(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt32LE=function(t,e){return t>>>=0,e||T(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},s.prototype.readInt32BE=function(t,e){return t>>>=0,e||T(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},s.prototype.readFloatLE=function(t,e){return t>>>=0,e||T(t,4,this.length),r.read(this,t,!0,23,4)},s.prototype.readFloatBE=function(t,e){return t>>>=0,e||T(t,4,this.length),r.read(this,t,!1,23,4)},s.prototype.readDoubleLE=function(t,e){return t>>>=0,e||T(t,8,this.length),r.read(this,t,!0,52,8)},s.prototype.readDoubleBE=function(t,e){return t>>>=0,e||T(t,8,this.length),r.read(this,t,!1,52,8)},s.prototype.writeUIntLE=function(t,e,r,i){if(t=+t,e>>>=0,r>>>=0,!i){var n=Math.pow(2,8*r)-1;F(this,t,e,r,n,0)}var s=1,o=0;for(this[e]=255&t;++o<r&&(s*=256);)this[e+o]=t/s&255;return e+r},s.prototype.writeUIntBE=function(t,e,r,i){if(t=+t,e>>>=0,r>>>=0,!i){var n=Math.pow(2,8*r)-1;F(this,t,e,r,n,0)}var s=r-1,o=1;for(this[e+s]=255&t;--s>=0&&(o*=256);)this[e+s]=t/o&255;return e+r},s.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||F(this,t,e,1,255,0),this[e]=255&t,e+1},s.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||F(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||F(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||F(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},s.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||F(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeIntLE=function(t,e,r,i){if(t=+t,e>>>=0,!i){var n=Math.pow(2,8*r-1);F(this,t,e,r,n-1,-n)}var s=0,o=1,a=0;for(this[e]=255&t;++s<r&&(o*=256);)t<0&&0===a&&0!==this[e+s-1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+r},s.prototype.writeIntBE=function(t,e,r,i){if(t=+t,e>>>=0,!i){var n=Math.pow(2,8*r-1);F(this,t,e,r,n-1,-n)}var s=r-1,o=1,a=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===a&&0!==this[e+s+1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+r},s.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||F(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},s.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||F(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||F(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||F(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},s.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||F(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeFloatLE=function(t,e,r){return D(this,t,e,!0,r)},s.prototype.writeFloatBE=function(t,e,r){return D(this,t,e,!1,r)},s.prototype.writeDoubleLE=function(t,e,r){return A(this,t,e,!0,r)},s.prototype.writeDoubleBE=function(t,e,r){return A(this,t,e,!1,r)},s.prototype.copy=function(t,e,r,i){if(!s.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<r&&(i=r),i===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-r&&(i=t.length-e+r);var n=i-r;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,r,i);else if(this===t&&r<e&&e<i)for(var o=n-1;o>=0;--o)t[o+e]=this[o+r];else Uint8Array.prototype.set.call(t,this.subarray(r,i),e);return n},s.prototype.fill=function(t,e,r,i){if("string"==typeof t){if("string"==typeof e?(i=e,e=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!s.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===t.length){var n=t.charCodeAt(0);("utf8"===i&&n<128||"latin1"===i)&&(t=n)}}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var a=s.isBuffer(t)?t:new s(t,i),c=a.length;if(0===c)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<r-e;++o)this[o+e]=a[o%c]}return this};var P=/[^+/0-9A-Za-z-_]/g;function L(t){return t<16?"0"+t.toString(16):t.toString(16)}function R(t,e){var r;e=e||1/0;for(var i=t.length,n=null,s=[],o=0;o<i;++o){if((r=t.charCodeAt(o))>55295&&r<57344){if(!n){if(r>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===i){(e-=3)>-1&&s.push(239,191,189);continue}n=r;continue}if(r<56320){(e-=3)>-1&&s.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&(e-=3)>-1&&s.push(239,191,189);if(n=null,r<128){if((e-=1)<0)break;s.push(r)}else if(r<2048){if((e-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function B(t){return e.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(P,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function U(t,e,r,i){for(var n=0;n<i&&!(n+r>=e.length||n>=t.length);++n)e[n+r]=t[n];return n}function C(t){return t instanceof ArrayBuffer||null!=t&&null!=t.constructor&&"ArrayBuffer"===t.constructor.name&&"number"==typeof t.byteLength}function M(t){return t!=t}return t.Buffer=s}),t("skylark-data-files/error-strings",["./files","./error-codes"],function(t,e){"use strict";const r={};return r[e.EPERM]="Operation not permitted.",r[e.ENOENT]="No such file or directory.",r[e.EIO]="Input/output error.",r[e.EBADF]="Bad file descriptor.",r[e.EACCES]="Permission denied.",r[e.EBUSY]="Resource busy or locked.",r[e.EEXIST]="File exists.",r[e.ENOTDIR]="File is not a directory.",r[e.EISDIR]="File is a directory.",r[e.EINVAL]="Invalid argument.",r[e.EFBIG]="File is too big.",r[e.ENOSPC]="No space left on disk.",r[e.EROFS]="Cannot modify a read-only file system.",r[e.ENOTEMPTY]="Directory is not empty.",r[e.ENOTSUP]="Operation is not supported.",t.ErrorStrings=r}),t("skylark-data-files/file-error",["skylark-langx-binary/buffer","./files","./error-codes","./error-strings"],function(t,e,r,i){"use strict";class n extends Error{constructor(t,e=i[t],n){super(e),this.syscall="",this.errno=t,this.code=r[t],this.path=n,this.stack=(new Error).stack,this.message=`Error: ${this.code}: ${e}${this.path?`, '${this.path}'`:""}`}static fromJSON(t){const e=new n(0);return e.errno=t.errno,e.code=t.code,e.path=t.path,e.stack=t.stack,e.message=t.message,e}static fromBuffer(t,e=0){return n.fromJSON(JSON.parse(t.toString("utf8",e+4,e+4+t.readUInt32LE(e))))}static create(t,e){return new n(t,i[t],e)}static ENOENT(t){return this.create(r.ENOENT,t)}static EEXIST(t){return this.create(r.EEXIST,t)}static EISDIR(t){return this.create(r.EISDIR,t)}static ENOTDIR(t){return this.create(r.ENOTDIR,t)}static EPERM(t){return this.create(r.EPERM,t)}static ENOTEMPTY(t){return this.create(r.ENOTEMPTY,t)}toString(){return this.message}toJSON(){return{errno:this.errno,code:this.code,path:this.path,stack:this.stack,message:this.message}}writeToBuffer(e=t.alloc(this.bufferSize()),r=0){const i=e.write(JSON.stringify(this.toJSON()),r+4);return e.writeUInt32LE(i,r),e}bufferSize(){return 4+t.byteLength(JSON.stringify(this.toJSON()))}}return e.FileError=n}),t("skylark-data-files/base-file",["./files","./error-codes","./file-error"],function(t,e,r){"use strict";return t.BaseFile=class{sync(t){t(new r(e.ENOTSUP))}syncSync(){throw new r(e.ENOTSUP)}datasync(t){this.sync(t)}datasyncSync(){return this.syncSync()}chown(t,i,n){n(new r(e.ENOTSUP))}chownSync(t,i){throw new r(e.ENOTSUP)}chmod(t,i){i(new r(e.ENOTSUP))}chmodSync(t){throw new r(e.ENOTSUP)}utimes(t,i,n){n(new r(e.ENOTSUP))}utimesSync(t,i){throw new r(e.ENOTSUP)}}}),t("skylark-data-files/file-flag",["./files","./error-codes","./file-error","./action-type"],function(t,e,r,i){"use strict";class n{constructor(t){if(this.flagStr=t,n.validFlagStrs.indexOf(t)<0)throw new r(e.EINVAL,"Invalid flag: "+t)}static getFileFlag(t){return n.flagCache.hasOwnProperty(t)?n.flagCache[t]:n.flagCache[t]=new n(t)}getFlagString(){return this.flagStr}isReadable(){return-1!==this.flagStr.indexOf("r")||-1!==this.flagStr.indexOf("+")}isWriteable(){return-1!==this.flagStr.indexOf("w")||-1!==this.flagStr.indexOf("a")||-1!==this.flagStr.indexOf("+")}isTruncating(){return-1!==this.flagStr.indexOf("w")}isAppendable(){return-1!==this.flagStr.indexOf("a")}isSynchronous(){return-1!==this.flagStr.indexOf("s")}isExclusive(){return-1!==this.flagStr.indexOf("x")}pathExistsAction(){return this.isExclusive()?i.THROW_EXCEPTION:this.isTruncating()?i.TRUNCATE_FILE:i.NOP}pathNotExistsAction(){return(this.isWriteable()||this.isAppendable())&&"r+"!==this.flagStr?i.CREATE_FILE:i.THROW_EXCEPTION}}return n.flagCache={},n.validFlagStrs=["r","r+","rs","rs+","w","wx","w+","wx+","a","ax","a+","ax+"],t.FileFlag=n}),t("skylark-data-files/file-type",["./files"],function(t){"use strict";var e;return function(t){t[t.FILE=32768]="FILE",t[t.DIRECTORY=16384]="DIRECTORY",t[t.SYMLINK=40960]="SYMLINK"}(e||(e={})),t.FileType=e}),t("skylark-data-files/stats",["skylark-langx-binary/buffer","./files","./file-type"],function(t,e,r){"use strict";class i{constructor(t,e,i,n,s,o,a){this.dev=0,this.ino=0,this.rdev=0,this.nlink=1,this.blksize=4096,this.uid=0,this.gid=0,this.fileData=null,this.size=e;let c=0;if("number"!=typeof n&&(c=Date.now(),n=c),"number"!=typeof s&&(c||(c=Date.now()),s=c),"number"!=typeof o&&(c||(c=Date.now()),o=c),"number"!=typeof a&&(c||(c=Date.now()),a=c),this.atimeMs=n,this.ctimeMs=o,this.mtimeMs=s,this.birthtimeMs=a,i)this.mode=i;else switch(t){case r.FILE:this.mode=420;break;case r.DIRECTORY:default:this.mode=511}this.blocks=Math.ceil(e/512),this.mode<4096&&(this.mode|=t)}static fromBuffer(t){const e=t.readUInt32LE(0),r=t.readUInt32LE(4),n=t.readDoubleLE(8),s=t.readDoubleLE(16),o=t.readDoubleLE(24);return new i(61440&r,e,4095&r,n,s,o)}static clone(t){return new i(61440&t.mode,t.size,4095&t.mode,t.atimeMs,t.mtimeMs,t.ctimeMs,t.birthtimeMs)}get atime(){return new Date(this.atimeMs)}get mtime(){return new Date(this.mtimeMs)}get ctime(){return new Date(this.ctimeMs)}get birthtime(){return new Date(this.birthtimeMs)}toBuffer(){const e=t.alloc(32);return e.writeUInt32LE(this.size,0),e.writeUInt32LE(this.mode,4),e.writeDoubleLE(this.atime.getTime(),8),e.writeDoubleLE(this.mtime.getTime(),16),e.writeDoubleLE(this.ctime.getTime(),24),e}isFile(){return(61440&this.mode)===r.FILE}isDirectory(){return(61440&this.mode)===r.DIRECTORY}isSymbolicLink(){return(61440&this.mode)===r.SYMLINK}chmod(t){this.mode=61440&this.mode|t}isSocket(){return!1}isBlockDevice(){return!1}isCharacterDevice(){return!1}isFIFO(){return!1}}return e.Stats=i}),t("skylark-data-files/file-system",["skylark-langx-funcs/defer","skylark-langx-binary/buffer","skylark-langx-paths","./files","./error-codes","./file-error","./file-flag","./stats"],function(t,e,r,i,n,s,o,a){"use strict";let c=function(t,e){return t};function l(e,r){if("function"!=typeof e)throw new Error("Callback must be a function.");const i=c(e,r);switch(r){case 1:return function(e){t(function(){return i(e)})};case 2:return function(e,r){t(function(){return i(e,r)})};case 3:return function(e,r,n){t(function(){return i(e,r,n)})};default:throw new Error("Invalid invocation of wrapCb.")}}function h(t){if(t)return t;throw new s(n.EIO,"Initialize BrowserFS with a file system using BrowserFS.initialize(filesystem)")}function u(t,e){switch(typeof t){case"number":return t;case"string":const r=parseInt(t,8);return isNaN(r)?e:r;default:return e}}function f(t){if(t instanceof Date)return t;if("number"==typeof t)return new Date(1e3*t);throw new s(n.EINVAL,"Invalid time.")}function d(t){if(t.indexOf("\0")>=0)throw new s(n.EINVAL,"Path must be a string without null bytes.");if(""===t)throw new s(n.EINVAL,"Path must not be empty.");return r.resolve(t)}function y(t,e,r,i){switch(null===t?"null":typeof t){case"object":return{encoding:void 0!==t.encoding?t.encoding:e,flag:void 0!==t.flag?t.flag:r,mode:u(t.mode,i)};case"string":return{encoding:t,flag:r,mode:i};case"null":case"undefined":case"function":return{encoding:e,flag:r,mode:i};default:throw new TypeError(`"options" must be a string or an object, got ${typeof t} instead.`)}}function p(){}return i.FileSystem=class{constructor(){this.F_OK=0,this.R_OK=4,this.W_OK=2,this.X_OK=1,this.root=null,this.fdMap={},this.nextFd=100}initialize(t){if(!t.constructor.isAvailable())throw new s(n.EINVAL,"Tried to instantiate BrowserFS with an unavailable file system.");return this.root=t}_toUnixTimestamp(t){if("number"==typeof t)return t;if(t instanceof Date)return t.getTime()/1e3;throw new Error("Cannot parse time: "+t)}getRootFS(){return this.root?this.root:null}rename(t,e,r=p){const i=l(r,1);try{h(this.root).rename(d(t),d(e),i)}catch(t){i(t)}}renameSync(t,e){h(this.root).renameSync(d(t),d(e))}exists(t,e=p){const r=l(e,1);try{return h(this.root).exists(d(t),r)}catch(t){return r(!1)}}existsSync(t){try{return h(this.root).existsSync(d(t))}catch(t){return!1}}stat(t,e=p){const r=l(e,2);try{return h(this.root).stat(d(t),!1,r)}catch(t){return r(t)}}statSync(t){return h(this.root).statSync(d(t),!1)}lstat(t,e=p){const r=l(e,2);try{return h(this.root).stat(d(t),!0,r)}catch(t){return r(t)}}lstatSync(t){return h(this.root).statSync(d(t),!0)}truncate(t,e=0,r=p){let i=0;"function"==typeof e?r=e:"number"==typeof e&&(i=e);const o=l(r,1);try{if(i<0)throw new s(n.EINVAL);return h(this.root).truncate(d(t),i,o)}catch(t){return o(t)}}truncateSync(t,e=0){if(e<0)throw new s(n.EINVAL);return h(this.root).truncateSync(d(t),e)}unlink(t,e=p){const r=l(e,1);try{return h(this.root).unlink(d(t),r)}catch(t){return r(t)}}unlinkSync(t){return h(this.root).unlinkSync(d(t))}open(t,e,r,i=p){const n=u(r,420),s=l(i="function"==typeof r?r:i,2);try{h(this.root).open(d(t),o.getFileFlag(e),n,(t,e)=>{e?s(t,this.getFdForFile(e)):s(t)})}catch(t){s(t)}}openSync(t,e,r=420){return this.getFdForFile(h(this.root).openSync(d(t),o.getFileFlag(e),u(r,420)))}readFile(t,e={},r=p){const i=y(e,null,"r",null),a=l(r="function"==typeof e?e:r,2);try{const e=o.getFileFlag(i.flag);return e.isReadable()?h(this.root).readFile(d(t),i.encoding,e,a):a(new s(n.EINVAL,"Flag passed to readFile must allow for reading."))}catch(t){return a(t)}}readFileSync(t,e={}){const r=y(e,null,"r",null),i=o.getFileFlag(r.flag);if(!i.isReadable())throw new s(n.EINVAL,"Flag passed to readFile must allow for reading.");return h(this.root).readFileSync(d(t),r.encoding,i)}writeFile(t,e,r={},i=p){const a=y(r,"utf8","w",420),c=l(i="function"==typeof r?r:i,1);try{const r=o.getFileFlag(a.flag);return r.isWriteable()?h(this.root).writeFile(d(t),e,a.encoding,r,a.mode,c):c(new s(n.EINVAL,"Flag passed to writeFile must allow for writing."))}catch(t){return c(t)}}writeFileSync(t,e,r){const i=y(r,"utf8","w",420),a=o.getFileFlag(i.flag);if(!a.isWriteable())throw new s(n.EINVAL,"Flag passed to writeFile must allow for writing.");return h(this.root).writeFileSync(d(t),e,i.encoding,a,i.mode)}appendFile(t,e,r,i=p){const a=y(r,"utf8","a",420),c=l(i="function"==typeof r?r:i,1);try{const r=o.getFileFlag(a.flag);if(!r.isAppendable())return c(new s(n.EINVAL,"Flag passed to appendFile must allow for appending."));h(this.root).appendFile(d(t),e,a.encoding,r,a.mode,c)}catch(t){c(t)}}appendFileSync(t,e,r){const i=y(r,"utf8","a",420),a=o.getFileFlag(i.flag);if(!a.isAppendable())throw new s(n.EINVAL,"Flag passed to appendFile must allow for appending.");return h(this.root).appendFileSync(d(t),e,i.encoding,a,i.mode)}fstat(t,e=p){const r=l(e,2);try{const e=this.fd2file(t);e.stat(r)}catch(t){r(t)}}fstatSync(t){return this.fd2file(t).statSync()}close(t,e=p){const r=l(e,1);try{this.fd2file(t).close(e=>{e||this.closeFd(t),r(e)})}catch(t){r(t)}}closeSync(t){this.fd2file(t).closeSync(),this.closeFd(t)}ftruncate(t,e,r=p){const i="number"==typeof e?e:0,o=l(r="function"==typeof e?e:r,1);try{const e=this.fd2file(t);if(i<0)throw new s(n.EINVAL);e.truncate(i,o)}catch(t){o(t)}}ftruncateSync(t,e=0){const r=this.fd2file(t);if(e<0)throw new s(n.EINVAL);r.truncateSync(e)}fsync(t,e=p){const r=l(e,1);try{this.fd2file(t).sync(r)}catch(t){r(t)}}fsyncSync(t){this.fd2file(t).syncSync()}fdatasync(t,e=p){const r=l(e,1);try{this.fd2file(t).datasync(r)}catch(t){r(t)}}fdatasyncSync(t){this.fd2file(t).datasyncSync()}write(t,r,i,o,a,c=p){let h,u,f,d=null;if("string"==typeof r){let t="utf8";switch(typeof i){case"function":c=i;break;case"number":d=i,t="string"==typeof o?o:"utf8",c="function"==typeof a?a:c;break;default:return(c="function"==typeof o?o:"function"==typeof a?a:c)(new s(n.EINVAL,"Invalid arguments."))}h=e.from(r,t),u=0,f=h.length}else h=r,u=i,f=o,d="number"==typeof a?a:null,c="function"==typeof a?a:c;const y=l(c,3);try{const e=this.fd2file(t);void 0!==d&&null!==d||(d=e.getPos()),e.write(h,u,f,d,y)}catch(t){y(t)}}writeSync(t,r,i,n,s){let o,a,c,l=0;if("string"==typeof r){c="number"==typeof i?i:null;const t="string"==typeof n?n:"utf8";l=0,o=e.from(r,t),a=o.length}else o=r,l=i,a=n,c="number"==typeof s?s:null;const h=this.fd2file(t);return void 0!==c&&null!==c||(c=h.getPos()),h.writeSync(o,l,a,c)}read(t,r,i,n,s,o=p){let a,c,h,u,f;if("number"==typeof r){h=r,a=i;const t=n;o="function"==typeof s?s:o,c=0,u=e.alloc(h),f=l((e,r,i)=>{if(e)return o(e);o(e,i.toString(t),r)},3)}else u=r,c=i,h=n,a=s,f=l(o,3);try{const e=this.fd2file(t);void 0!==a&&null!==a||(a=e.getPos()),e.read(u,c,h,a,f)}catch(t){f(t)}}readSync(t,r,i,n,s){let o,a,c,l,h=!1,u="utf8";"number"==typeof r?(c=r,l=i,u=n,a=0,o=e.alloc(c),h=!0):(o=r,a=i,c=n,l=s);const f=this.fd2file(t);void 0!==l&&null!==l||(l=f.getPos());const d=f.readSync(o,a,c,l);return h?[o.toString(u),d]:d}fchown(t,e,r,i=p){const n=l(i,1);try{this.fd2file(t).chown(e,r,n)}catch(t){n(t)}}fchownSync(t,e,r){this.fd2file(t).chownSync(e,r)}fchmod(t,e,r){const i=l(r,1);try{const r="string"==typeof e?parseInt(e,8):e;this.fd2file(t).chmod(r,i)}catch(t){i(t)}}fchmodSync(t,e){const r="string"==typeof e?parseInt(e,8):e;this.fd2file(t).chmodSync(r)}futimes(t,e,r,i=p){const n=l(i,1);try{const i=this.fd2file(t);"number"==typeof e&&(e=new Date(1e3*e)),"number"==typeof r&&(r=new Date(1e3*r)),i.utimes(e,r,n)}catch(t){n(t)}}futimesSync(t,e,r){this.fd2file(t).utimesSync(f(e),f(r))}rmdir(t,e=p){const r=l(e,1);try{t=d(t),h(this.root).rmdir(t,r)}catch(t){r(t)}}rmdirSync(t){return t=d(t),h(this.root).rmdirSync(t)}mkdir(t,e,r=p){"function"==typeof e&&(r=e,e=511);const i=l(r,1);try{t=d(t),h(this.root).mkdir(t,e,i)}catch(t){i(t)}}mkdirSync(t,e){h(this.root).mkdirSync(d(t),u(e,511))}readdir(t,e=p){const r=l(e,2);try{t=d(t),h(this.root).readdir(t,r)}catch(t){r(t)}}readdirSync(t){return t=d(t),h(this.root).readdirSync(t)}link(t,e,r=p){const i=l(r,1);try{t=d(t),e=d(e),h(this.root).link(t,e,i)}catch(t){i(t)}}linkSync(t,e){return t=d(t),e=d(e),h(this.root).linkSync(t,e)}symlink(t,e,r,i=p){const o="string"==typeof r?r:"file",a=l(i="function"==typeof r?r:i,1);try{if("file"!==o&&"dir"!==o)return a(new s(n.EINVAL,"Invalid type: "+o));t=d(t),e=d(e),h(this.root).symlink(t,e,o,a)}catch(t){a(t)}}symlinkSync(t,e,r){if(r){if("file"!==r&&"dir"!==r)throw new s(n.EINVAL,"Invalid type: "+r)}else r="file";return t=d(t),e=d(e),h(this.root).symlinkSync(t,e,r)}readlink(t,e=p){const r=l(e,2);try{t=d(t),h(this.root).readlink(t,r)}catch(t){r(t)}}readlinkSync(t){return t=d(t),h(this.root).readlinkSync(t)}chown(t,e,r,i=p){const n=l(i,1);try{t=d(t),h(this.root).chown(t,!1,e,r,n)}catch(t){n(t)}}chownSync(t,e,r){t=d(t),h(this.root).chownSync(t,!1,e,r)}lchown(t,e,r,i=p){const n=l(i,1);try{t=d(t),h(this.root).chown(t,!0,e,r,n)}catch(t){n(t)}}lchownSync(t,e,r){t=d(t),h(this.root).chownSync(t,!0,e,r)}chmod(t,e,r=p){const i=l(r,1);try{const r=u(e,-1);if(r<0)throw new s(n.EINVAL,"Invalid mode.");h(this.root).chmod(d(t),!1,r,i)}catch(t){i(t)}}chmodSync(t,e){const r=u(e,-1);if(r<0)throw new s(n.EINVAL,"Invalid mode.");t=d(t),h(this.root).chmodSync(t,!1,r)}lchmod(t,e,r=p){const i=l(r,1);try{const r=u(e,-1);if(r<0)throw new s(n.EINVAL,"Invalid mode.");h(this.root).chmod(d(t),!0,r,i)}catch(t){i(t)}}lchmodSync(t,e){const r=u(e,-1);if(r<1)throw new s(n.EINVAL,"Invalid mode.");h(this.root).chmodSync(d(t),!0,r)}utimes(t,e,r,i=p){const n=l(i,1);try{h(this.root).utimes(d(t),f(e),f(r),n)}catch(t){n(t)}}utimesSync(t,e,r){h(this.root).utimesSync(d(t),f(e),f(r))}realpath(t,e,r=p){const i="object"==typeof e?e:{},n=l("function"==typeof e?e:p,2);try{t=d(t),h(this.root).realpath(t,i,n)}catch(t){n(t)}}realpathSync(t,e={}){return t=d(t),h(this.root).realpathSync(t,e)}watchFile(t,e,r=p){throw new s(n.ENOTSUP)}unwatchFile(t,e=p){throw new s(n.ENOTSUP)}watch(t,e,r=p){throw new s(n.ENOTSUP)}access(t,e,r=p){throw new s(n.ENOTSUP)}accessSync(t,e){throw new s(n.ENOTSUP)}createReadStream(t,e){throw new s(n.ENOTSUP)}createWriteStream(t,e){throw new s(n.ENOTSUP)}wrapCallbacks(t){c=t}getFdForFile(t){const e=this.nextFd++;return this.fdMap[e]=t,e}fd2file(t){const e=this.fdMap[t];if(e)return e;throw new s(n.EBADF,"Invalid file descriptor.")}closeFd(t){delete this.fdMap[t]}}}),t("skylark-data-files/utils",["skylark-langx-binary/buffer","skylark-langx-paths","./file-error","./error-codes"],function(t,e,r,i){"use strict";const n="undefined"!=typeof navigator&&!(!/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())&&-1===navigator.userAgent.indexOf("Trident")),s="undefined"==typeof window;function o(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function a(e){return e instanceof t?e:0===e.byteOffset&&e.byteLength===e.buffer.byteLength?c(e.buffer):t.from(e.buffer,e.byteOffset,e.byteLength)}function c(e){return t.from(e)}let l=null;function h(){return l||(l=t.alloc(0))}return{deprecationMessage:function(t,e,r){t&&console.warn(`[${e}] Direct file system constructor usage is deprecated for this file system, and will be removed in the next major version. Please use the '${e}.Create(${JSON.stringify(r)}, callback)' method instead. See https://github.com/jvilk/BrowserFS/issues/176 for more details.`)},isIE:n,isWebWorker:s,fail:function(){throw new Error("BFS has reached an impossible code path; please file a bug.")},mkdirpSync:function t(r,i,n){n.existsSync(r)||(t(e.dirname(r),i,n),n.mkdirSync(r,i))},buffer2ArrayBuffer:function(t){const e=o(t),r=e.byteOffset,i=e.byteLength;return 0===r&&i===e.buffer.byteLength?e.buffer:e.buffer.slice(r,r+i)},buffer2Uint8array:o,arrayish2Buffer:function(e){return e instanceof t?e:e instanceof Uint8Array?a(e):t.from(e)},uint8Array2Buffer:a,arrayBuffer2Buffer:c,copyingSlice:function(t,e=0,r=t.length){if(e<0||r<0||r>t.length||e>r)throw new TypeError(`Invalid slice bounds on buffer of length ${t.length}: [${e}, ${r}]`);if(0===t.length)return h();{const i=o(t),n=t[0],s=(n+1)%255;return t[0]=s,i[0]===s?(i[0]=n,a(i.slice(e,r))):(t[0]=n,a(i.subarray(e,r)))}},emptyBuffer:h,bufferValidator:function(e,n){t.isBuffer(e)?n():n(new r(i.EINVAL,"option must be a Buffer."))},checkOptions:function(t,e,n){const s=t.Options,o=t.Name;let a=0,c=!1,l=!1;function h(t){c||(t&&(c=!0,n(t)),0===--a&&l&&n())}for(const t in s)if(s.hasOwnProperty(t)){const l=s[t],u=e[t];if(void 0===u||null===u){if(!l.optional){const a=Object.keys(e).filter(t=>!(t in s)).map(e=>({str:e,distance:levenshtein(t,e)})).filter(t=>t.distance<5).sort((t,e)=>t.distance-e.distance);if(c)return;return c=!0,n(new r(i.EINVAL,`[${o}] Required option '${t}' not provided.${a.length>0?` You provided unrecognized option '${a[0].str}'; perhaps you meant to type '${t}'.`:""}\nOption description: ${l.description}`))}}else{let e=!1;if(!(e=Array.isArray(l.type)?-1!==l.type.indexOf(typeof u):typeof u===l.type)){if(c)return;return c=!0,n(new r(i.EINVAL,`[${o}] Value provided for option ${t} is not the proper type. Expected ${Array.isArray(l.type)?`one of {${l.type.join(", ")}}`:l.type}, but received ${typeof u}\nOption description: ${l.description}`))}l.validator&&(a++,l.validator(u,h))}}l=!0,0!==a||c||n()}}}),t("skylark-data-files/preload-file",["skylark-langx-binary/buffer","./files","./error-codes","./file-error","./stats","./base-file","./utils"],function(t,e,r,i,n,s,o){"use strict";const{emptyBuffer:a}=o;return e.PreloadFile=class extends s{constructor(t,e,r,i,n){if(super(),this._pos=0,this._dirty=!1,this._fs=t,this._path=e,this._flag=r,this._stat=i,this._buffer=n||a(),this._stat.size!==this._buffer.length&&this._flag.isReadable())throw new Error(`Invalid buffer: Buffer is ${this._buffer.length} long, yet Stats object specifies that file is ${this._stat.size} long.`)}getBuffer(){return this._buffer}getStats(){return this._stat}getFlag(){return this._flag}getPath(){return this._path}getPos(){return this._flag.isAppendable()?this._stat.size:this._pos}advancePos(t){return this._pos+=t}setPos(t){return this._pos=t}sync(t){try{this.syncSync(),t()}catch(e){t(e)}}syncSync(){throw new i(r.ENOTSUP)}close(t){try{this.closeSync(),t()}catch(e){t(e)}}closeSync(){throw new i(r.ENOTSUP)}stat(t){try{t(null,n.clone(this._stat))}catch(e){t(e)}}statSync(){return n.clone(this._stat)}truncate(t,e){try{this.truncateSync(t),this._flag.isSynchronous()&&!fs.getRootFS().supportsSynch()&&this.sync(e),e()}catch(t){return e(t)}}truncateSync(e){if(this._dirty=!0,!this._flag.isWriteable())throw new i(r.EPERM,"File not opened with a writeable mode.");if(this._stat.mtimeMs=Date.now(),e>this._buffer.length){const r=t.alloc(e-this._buffer.length,0);return this.writeSync(r,0,r.length,this._buffer.length),void(this._flag.isSynchronous()&&fs.getRootFS().supportsSynch()&&this.syncSync())}this._stat.size=e;const n=t.alloc(e);this._buffer.copy(n,0,0,e),this._buffer=n,this._flag.isSynchronous()&&fs.getRootFS().supportsSynch()&&this.syncSync()}write(t,e,r,i,n){try{n(null,this.writeSync(t,e,r,i),t)}catch(t){n(t)}}writeSync(e,n,s,o){if(this._dirty=!0,void 0!==o&&null!==o||(o=this.getPos()),!this._flag.isWriteable())throw new i(r.EPERM,"File not opened with a writeable mode.");const a=o+s;if(a>this._stat.size&&(this._stat.size=a,a>this._buffer.length)){const e=t.alloc(a);this._buffer.copy(e),this._buffer=e}const c=e.copy(this._buffer,o,n,n+s);return this._stat.mtimeMs=Date.now(),this._flag.isSynchronous()?(this.syncSync(),c):(this.setPos(o+c),c)}read(t,e,r,i,n){try{n(null,this.readSync(t,e,r,i),t)}catch(t){n(t)}}readSync(t,e,n,s){if(!this._flag.isReadable())throw new i(r.EPERM,"File not opened with a readable mode.");void 0!==s&&null!==s||(s=this.getPos());const o=s+n;o>this._stat.size&&(n=this._stat.size-s);const a=this._buffer.copy(t,e,s,s+n);return this._stat.atimeMs=Date.now(),this._pos=s+n,a}chmod(t,e){try{this.chmodSync(t),e()}catch(t){e(t)}}chmodSync(t){if(!this._fs.supportsProps())throw new i(r.ENOTSUP);this._dirty=!0,this._stat.chmod(t),this.syncSync()}isDirty(){return this._dirty}resetDirty(){this._dirty=!1}}}),t("skylark-data-files/no-sync-file",["./files","./preload-file"],function(t,e){"use strict";return t.NoSyncFile=class extends e{constructor(t,e,r,i,n){super(t,e,r,i,n)}sync(t){t()}syncSync(){}close(t){t()}closeSync(){}}}),t("skylark-data-files/providers/registry",["../files"],function(t){var e={};return t.providers.registry={get:function(t){return e[t]},add:function(t,r){e[t]=r}}}),t("skylark-data-files/configure",["./files","./file-system","./error-codes","./file-error","./providers/registry"],function(t,e,r,i,n){"use strict";var s=t.fs=new e;return t.configure=function(t,e){!function t(e,s){const o=e.fs;if(!o)return s(new i(r.EPERM,'Missing "fs" property on configuration object.'));const a=e.options;let c=0;let l=!1;function h(){if(!l){l=!0;const t=n.get(o);t?t.Create(a,s):s(new i(r.EPERM,`File system ${o} is not available in BrowserFS.`))}}if(null!==a&&"object"==typeof a){let e=!1;const r=Object.keys(a).filter(t=>"fs"!==t);r.forEach(r=>{const i=a[r];null!==i&&"object"==typeof i&&i.fs&&(c++,t(i,function(t,i){if(c--,t){if(l)return;l=!0,s(t)}else a[r]=i,0===c&&e&&h()}))}),e=!0}0===c&&h()}(t,(t,r)=>{r?(o=r,s.initialize(o),e(null,s)):e(t)});var o}}),t("skylark-data-files/providers/base-provider",["skylark-langx-binary/buffer","skylark-langx-paths","../files","../error-codes","../file-error","../action-type","../file-flag","../utils"],function(t,e,r,i,n,s,o,a){"use strict";const{fail:c}=a;return r.providers.BaseProvider=class{supportsLinks(){return!1}diskSpace(t,e){e(0,0)}openFile(t,e,r){throw new n(i.ENOTSUP)}createFile(t,e,r,s){throw new n(i.ENOTSUP)}open(t,r,o,a){this.stat(t,!1,(l,h)=>{if(l)switch(r.pathNotExistsAction()){case s.CREATE_FILE:return this.stat(e.dirname(t),!1,(i,s)=>{i?a(i):s&&!s.isDirectory()?a(n.ENOTDIR(e.dirname(t))):this.createFile(t,r,o,a)});case s.THROW_EXCEPTION:return a(n.ENOENT(t));default:return a(new n(i.EINVAL,"Invalid FileFlag object."))}else{if(h&&h.isDirectory())return a(n.EISDIR(t));switch(r.pathExistsAction()){case s.THROW_EXCEPTION:return a(n.EEXIST(t));case s.TRUNCATE_FILE:return this.openFile(t,r,(t,e)=>{t?a(t):e?e.truncate(0,()=>{e.sync(()=>{a(null,e)})}):c()});case s.NOP:return this.openFile(t,r,a);default:return a(new n(i.EINVAL,"Invalid FileFlag object."))}}})}rename(t,e,r){r(new n(i.ENOTSUP))}renameSync(t,e){throw new n(i.ENOTSUP)}stat(t,e,r){r(new n(i.ENOTSUP))}statSync(t,e){throw new n(i.ENOTSUP)}openFileSync(t,e,r){throw new n(i.ENOTSUP)}createFileSync(t,e,r){throw new n(i.ENOTSUP)}openSync(t,r,o){let a;try{a=this.statSync(t,!1)}catch(a){switch(r.pathNotExistsAction()){case s.CREATE_FILE:const a=this.statSync(e.dirname(t),!1);if(!a.isDirectory())throw n.ENOTDIR(e.dirname(t));return this.createFileSync(t,r,o);case s.THROW_EXCEPTION:throw n.ENOENT(t);default:throw new n(i.EINVAL,"Invalid FileFlag object.")}}if(a.isDirectory())throw n.EISDIR(t);switch(r.pathExistsAction()){case s.THROW_EXCEPTION:throw n.EEXIST(t);case s.TRUNCATE_FILE:return this.unlinkSync(t),this.createFileSync(t,r,a.mode);case s.NOP:return this.openFileSync(t,r,o);default:throw new n(i.EINVAL,"Invalid FileFlag object.")}}unlink(t,e){e(new n(i.ENOTSUP))}unlinkSync(t){throw new n(i.ENOTSUP)}rmdir(t,e){e(new n(i.ENOTSUP))}rmdirSync(t){throw new n(i.ENOTSUP)}mkdir(t,e,r){r(new n(i.ENOTSUP))}mkdirSync(t,e){throw new n(i.ENOTSUP)}readdir(t,e){e(new n(i.ENOTSUP))}readdirSync(t){throw new n(i.ENOTSUP)}exists(t,e){this.stat(t,null,function(t){e(!t)})}existsSync(t){try{return this.statSync(t,!0),!0}catch(t){return!1}}realpath(t,r,i){if(this.supportsLinks()){const r=t.split(e.sep);for(let t=0;t<r.length;t++){const i=r.slice(0,t+1);r[t]=e.join.apply(null,i)}}else this.exists(t,function(e){e?i(null,t):i(n.ENOENT(t))})}realpathSync(t,r){if(this.supportsLinks()){const r=t.split(e.sep);for(let t=0;t<r.length;t++){const i=r.slice(0,t+1);r[t]=e.join.apply(path,i)}return r.join(e.sep)}if(this.existsSync(t))return t;throw n.ENOENT(t)}truncate(t,e,r){this.open(t,o.getFileFlag("r+"),420,function(t,i){if(t)return r(t);i.truncate(e,function(t){i.close(function(e){r(t||e)})})})}truncateSync(t,e){const r=this.openSync(t,o.getFileFlag("r+"),420);try{r.truncateSync(e)}catch(t){throw t}finally{r.closeSync()}}readFile(e,r,i,n){const s=n;this.open(e,i,420,(e,i)=>{if(e)return n(e);n=function(t,e){i.close(function(r){return t||(t=r),s(t,e)})},i.stat((e,s)=>{if(e)return n(e);const o=t.alloc(s.size);i.read(o,0,s.size,0,t=>{if(t)return n(t);if(null===r)return n(t,o);try{n(null,o.toString(r))}catch(t){n(t)}})})})}readFileSync(e,r,i){const n=this.openSync(e,i,420);try{const e=n.statSync(),i=t.alloc(e.size);return n.readSync(i,0,e.size,0),n.closeSync(),null===r?i:i.toString(r)}finally{n.closeSync()}}writeFile(e,r,i,n,s,o){const a=o;this.open(e,n,420,function(e,n){if(e)return o(e);o=function(t){n.close(function(e){a(t||e)})};try{"string"==typeof r&&(r=t.from(r,i))}catch(t){return o(t)}n.write(r,0,r.length,0,o)})}writeFileSync(e,r,i,n,s){const o=this.openSync(e,n,s);try{"string"==typeof r&&(r=t.from(r,i)),o.writeSync(r,0,r.length,0)}finally{o.closeSync()}}appendFile(e,r,i,n,s,o){const a=o;this.open(e,n,s,function(e,n){if(e)return o(e);o=function(t){n.close(function(e){a(t||e)})},"string"==typeof r&&(r=t.from(r,i)),n.write(r,0,r.length,null,o)})}appendFileSync(e,r,i,n,s){const o=this.openSync(e,n,s);try{"string"==typeof r&&(r=t.from(r,i)),o.writeSync(r,0,r.length,null)}finally{o.closeSync()}}chmod(t,e,r,s){s(new n(i.ENOTSUP))}chmodSync(t,e,r){throw new n(i.ENOTSUP)}chown(t,e,r,s,o){o(new n(i.ENOTSUP))}chownSync(t,e,r,s){throw new n(i.ENOTSUP)}utimes(t,e,r,s){s(new n(i.ENOTSUP))}utimesSync(t,e,r){throw new n(i.ENOTSUP)}link(t,e,r){r(new n(i.ENOTSUP))}linkSync(t,e){throw new n(i.ENOTSUP)}symlink(t,e,r,s){s(new n(i.ENOTSUP))}symlinkSync(t,e,r){throw new n(i.ENOTSUP)}readlink(t,e){e(new n(i.ENOTSUP))}readlinkSync(t){throw new n(i.ENOTSUP)}}}),t("skylark-data-files/providers/dropbox/dropbox-file",["../../preload-file"],function(t){"use strict";return class extends t{constructor(t,e,r,i,n){super(t,e,r,i,n)}sync(t){this._fs._syncFile(this.getPath(),this.getBuffer(),t)}close(t){this.sync(t)}}}),t("skylark-data-files/providers/dropbox/dropbox-provider",["skylark-langx-funcs/defer","skylark-langx-binary/buffer","skylark-langx-paths","../../files","../registry","../base-provider","../../stats","../../file-type","../../file-error","../../error-codes","../../utils","./dropbox-file"],function(t,e,r,i,n,s,o,a,c,l,h,u){"use strict";const{arrayBuffer2Buffer:f,buffer2ArrayBuffer:d}=h,{dirname:y}=r;function p(t){return"/"===t?"":t}function w(t){const e=t.error;if(e[".tag"])return e;if(e.error){const t=e.error;return t[".tag"]?t:t.reason&&t.reason[".tag"]?t.reason:t}if("string"==typeof e)try{const r=JSON.parse(e);if(r.error&&r.error.reason&&r.error.reason[".tag"])return r.error.reason}catch(t){}return e}function g(t){if(t.user_message)return t.user_message.text;if(t.error_summary)return t.error_summary;if("string"==typeof t.error)return t.error;if("object"==typeof t.error)return g(t.error);throw new Error(`Dropbox's servers gave us a garbage error message: ${JSON.stringify(t)}`)}function m(t,e,r){switch(t[".tag"]){case"malformed_path":return new c(l.EBADF,r,e);case"not_found":return c.ENOENT(e);case"not_file":return c.EISDIR(e);case"not_folder":return c.ENOTDIR(e);case"restricted_content":return c.EPERM(e);case"other":default:return new c(l.EIO,r,e)}}function E(t,e,r){switch(t[".tag"]){case"malformed_path":case"disallowed_name":return new c(l.EBADF,r,e);case"conflict":case"no_write_permission":case"team_folder":return c.EPERM(e);case"insufficient_space":return new c(l.ENOSPC,r);case"other":default:return new c(l.EIO,r,e)}}function S(t,e,r){const i={path:p(e)};t.filesDeleteV2(i).then(()=>{r()}).catch(i=>{const n=w(i);switch(n[".tag"]){case"path_lookup":r(m(n.path_lookup,e,g(i)));break;case"path_write":r(E(n.path_write,e,g(i)));break;case"too_many_write_operations":setTimeout(()=>S(t,e,r),500+300*Math.random());break;case"other":default:r(new c(l.EIO,g(i),e))}})}class b extends s{constructor(t){super(),this._client=t}static Create(t,e){e(null,new b(t.client))}static isAvailable(){return"undefined"!=typeof Dropbox}getName(){return b.Name}isReadOnly(){return!1}supportsSymlinks(){return!1}supportsProps(){return!1}supportsSynch(){return!1}empty(t){this.readdir("/",(e,r)=>{if(r){const e=i=>{0===r.length?t():S(this._client,r.shift(),e)};e()}else t(e)})}rename(t,e,r){this.stat(e,!1,(i,n)=>{const s=()=>{const i={from_path:p(t),to_path:p(e)};this._client.filesMoveV2(i).then(()=>r()).catch(function(i){const n=w(i);switch(n[".tag"]){case"from_lookup":r(m(n.from_lookup,t,g(i)));break;case"from_write":r(E(n.from_write,t,g(i)));break;case"to":r(E(n.to,e,g(i)));break;case"cant_copy_shared_folder":case"cant_nest_shared_folder":r(new c(l.EPERM,g(i),t));break;case"cant_move_folder_into_itself":case"duplicated_or_nested_paths":r(new c(l.EBADF,g(i),t));break;case"too_many_files":r(new c(l.ENOSPC,g(i),t));break;case"other":default:r(new c(l.EIO,g(i),t))}})};i?s():t===e?i?r(c.ENOENT(e)):r():n&&n.isDirectory()?r(c.EISDIR(e)):this.unlink(e,t=>{t?r(t):s()})})}stat(e,r,i){if("/"===e)return void t(function(){i(null,new o(a.DIRECTORY,4096))});const n={path:p(e)};this._client.filesGetMetadata(n).then(t=>{switch(t[".tag"]){case"file":const r=t;i(null,new o(a.FILE,r.size));break;case"folder":i(null,new o(a.DIRECTORY,4096));break;case"deleted":i(c.ENOENT(e))}}).catch(t=>{const r=w(t);switch(r[".tag"]){case"path":i(m(r.path,e,g(t)));break;default:i(new c(l.EIO,g(t),e))}})}openFile(t,e,r){const i={path:p(t)};this._client.filesDownload(i).then(i=>{const n=i.fileBlob,s=new FileReader;s.onload=(()=>{const i=s.result;r(null,new u(this,t,e,new o(a.FILE,i.byteLength),f(i)))}),s.readAsArrayBuffer(n)}).catch(e=>{const i=w(e);switch(i[".tag"]){case"path":const n=i;r(m(n.path,t,g(e)));break;case"other":default:r(new c(l.EIO,g(e),t))}})}createFile(t,r,i,n){const s=e.alloc(0),h=new Blob([d(s)],{type:"octet/stream"}),f={contents:h,path:p(t)};this._client.filesUpload(f).then(e=>{n(null,new u(this,t,r,new o(a.FILE,0),s))}).catch(e=>{const s=w(e);switch(s[".tag"]){case"path":const o=s;n(E(o.path.reason,t,g(e)));break;case"too_many_write_operations":setTimeout(()=>this.createFile(t,r,i,n),500+300*Math.random());break;case"other":default:n(new c(l.EIO,g(e),t))}})}unlink(t,e){this.stat(t,!1,(r,i)=>{i?i.isDirectory()?e(c.EISDIR(t)):S(this._client,t,e):e(r)})}rmdir(t,e){this.readdir(t,(r,i)=>{i?i.length>0?e(c.ENOTEMPTY(t)):S(this._client,t,e):e(r)})}mkdir(t,e,r){const i=y(t);this.stat(i,!1,(n,s)=>{if(n)r(n);else if(s&&!s.isDirectory())r(c.ENOTDIR(i));else{const i={path:p(t)};this._client.filesCreateFolderV2(i).then(()=>r()).catch(i=>{const n=w(i);"too_many_write_operations"===n[".tag"]?setTimeout(()=>this.mkdir(t,e,r),500+300*Math.random()):r(E(w(i).path,t,g(i)))})}})}readdir(t,e){const r={path:p(t)};this._client.filesListFolder(r).then(r=>{!function t(e,r,i,n,s){const o=i.entries.map(t=>t.path_display).filter(t=>!!t);const a=n.concat(o);if(i.has_more){const n={cursor:i.cursor};e.filesListFolderContinue(n).then(i=>{t(e,r,i,a,s)}).catch(t=>{_(t,r,s)})}else s(null,a)}(this._client,t,r,[],e)}).catch(r=>{_(r,t,e)})}_syncFile(t,e,r){const i=new Blob([d(e)],{type:"octet/stream"}),n={contents:i,path:p(t),mode:{".tag":"overwrite"}};this._client.filesUpload(n).then(()=>{r()}).catch(i=>{const n=w(i);switch(n[".tag"]){case"path":const s=n;r(E(s.path.reason,t,g(i)));break;case"too_many_write_operations":setTimeout(()=>this._syncFile(t,e,r),500+300*Math.random());break;case"other":default:r(new c(l.EIO,g(i),t))}})}}function _(t,e,r){const i=w(t);switch(i[".tag"]){case"path":const n=i;r(m(n.path,e,g(t)));break;case"other":default:r(new c(l.EIO,g(t),e))}}return b.Name="DropboxV2",b.Options={client:{type:"object",description:"An *authenticated* Dropbox client. Must be from the 2.5.x JS SDK."}},b.DropboxFile=u,n.add("dropbox",b),i.providers.DropboxProvider=b}),t("skylark-data-files/providers/html5/html5-lfs-file",["../../utils","../../preload-file"],function(t,e){"use strict";const{buffer2ArrayBuffer:r,arrayBuffer2Buffer:i}=t;return class extends e{constructor(t,e,r,i,n,s){super(t,r,i,n,s),this._entry=e}sync(t){if(!this.isDirty())return t();this._entry.createWriter(e=>{const i=this.getBuffer(),n=new Blob([r(i)]),s=n.size;e.onwriteend=(r=>{e.onwriteend=null,e.onerror=null,e.truncate(s),this.resetDirty(),t()}),e.onerror=(e=>{t(convertError(e,this.getPath(),!1))}),e.write(n)})}close(t){this.sync(t)}}}),t("skylark-data-files/providers/html5/html5-lfs-provider",["skylark-langx-async","skylark-langx-paths","../../files","../registry","../../preload-file","../base-provider","../../error-codes","../../file-error","../../action-type","../../stats","../../file-type","../../utils","./html5-lfs-file"],function(t,e,r,i,n,s,o,a,c,l,h,u,f){"use strict";const d=t.each,{buffer2ArrayBuffer:y,arrayBuffer2Buffer:p}=u;const w=window.webkitRequestProvider||window.requestProvider||null;function g(t,e,r){switch(t.name){case"PathExistsError":return a.EEXIST(e);case"QuotaExceededError":return a.FileError(o.ENOSPC,e);case"NotFoundError":return a.ENOENT(e);case"SecurityError":return a.FileError(o.EACCES,e);case"InvalidModificationError":return a.FileError(o.EPERM,e);case"TypeMismatchError":return a.FileError(r?o.ENOTDIR:o.EISDIR,e);case"EncodingError":case"InvalidStateError":case"NoModificationAllowedError":default:return a.FileError(o.EINVAL,e)}}class m extends s{constructor(t=5,e=window.PERSISTENT){super(),this.size=1048576*t,this.type=e}static Create(t,e){const r=new m(t.size,t.type);r._allocate(t=>t?e(t):e(null,r))}static isAvailable(){return!!w}getName(){return m.Name}isReadOnly(){return!1}supportsSymlinks(){return!1}supportsProps(){return!1}supportsSynch(){return!1}empty(t){this._readdir("/",(e,r)=>{if(e)t(e);else{const i=r=>{e?t(e):t()},n=(t,e)=>{const r=()=>{e()},i=r=>{e(g(r,t.fullPath,!t.isDirectory))};t.isDirectory?t.removeRecursively(r,i):t.remove(r,i)};d(r,n,i)}})}rename(t,r,i){let n=2,s=0;const c=this.fs.root;let l=t;const h=t=>{--n<=0&&i(g(t,l,!1))},u=n=>2==++s?i(new a(o.EINVAL,"Something was identified as both a file and a directory. This should never happen.")):t===r?i():(l=e.dirname(r),void c.getDirectory(l,{},s=>{l=e.basename(r),n.moveTo(s,l,t=>{i()},e=>{n.isDirectory?(l=r,this.unlink(r,n=>{n?h(e):this.rename(t,r,i)})):h(e)})},h));c.getFile(t,{},u,h),c.getDirectory(t,{},u,h)}stat(t,e,r){const i={create:!1},n=t=>{const e=new l(h.DIRECTORY,4096);r(null,e)},s=e=>{r(g(e,t,!1))};this.fs.root.getFile(t,i,t=>{t.file(t=>{const e=new l(h.FILE,t.size);r(null,e)},s)},()=>{this.fs.root.getDirectory(t,i,n,s)})}open(t,e,r,i){const n=r=>{"InvalidModificationError"===r.name&&e.isExclusive()?i(a.EEXIST(t)):i(g(r,t,!1))};this.fs.root.getFile(t,{create:e.pathNotExistsAction()===c.CREATE_FILE,exclusive:e.isExclusive()},r=>{r.file(s=>{const o=new FileReader;o.onloadend=(n=>{const a=this._makeFile(t,r,e,s,o.result);i(null,a)}),o.onerror=(t=>{n(o.error)}),o.readAsArrayBuffer(s)},n)},n)}unlink(t,e){this._remove(t,e,!0)}rmdir(t,e){this.readdir(t,(r,i)=>{r?e(r):i.length>0?e(a.ENOTEMPTY(t)):this._remove(t,e,!1)})}mkdir(t,e,r){this.fs.root.getDirectory(t,{create:!0,exclusive:!0},t=>{r()},e=>{r(g(e,t,!0))})}readdir(t,e){this._readdir(t,(t,r)=>{if(!r)return e(t);{const t=[];for(const e of r)t.push(e.name);e(null,t)}})}_makeFile(t,e,r,i,n=new ArrayBuffer(0)){const s=new l(h.FILE,i.size),o=p(n);return new f(this,e,t,r,s,o)}_readdir(t,e){const r=r=>{e(g(r,t,!0))};var i;this.fs.root.getDirectory(t,{create:!1},t=>{const n=t.createReader();let s=[];const o=()=>{n.readEntries(t=>{t.length?(s=s.concat((i=t,Array.prototype.slice.call(i||[],0))),o()):e(null,s)},r)};o()},r)}_allocate(t){const e=e=>{this.fs=e,t()},r=e=>{t(g(e,"/",!0))};this.type===window.PERSISTENT?function(t,e,r,i){if(void 0!==navigator.webkitPersistentStorage)switch(t){case window.PERSISTENT:navigator.webkitPersistentStorage.requestQuota(e,r,i);break;case window.TEMPORARY:navigator.webkitTemporaryStorage.requestQuota(e,r,i);break;default:i(new TypeError(`Invalid storage type: ${t}`))}else window.webkitStorageInfo.requestQuota(t,e,r,i)}(this.type,this.size,t=>{w(this.type,t,e,r)},r):w(this.type,this.size,e,r)}_remove(t,e,r){const i=i=>{i.remove(()=>{e()},i=>{e(g(i,t,!r))})},n=i=>{e(g(i,t,!r))},s={create:!1};r?this.fs.root.getFile(t,s,i,n):this.fs.root.getDirectory(t,s,i,n)}}return m.Name="Html5LfsProvider",m.Options={size:{type:"number",optional:!0,description:"Storage quota to request, in megabytes. Allocated value may be less. Defaults to 5."},type:{type:"number",optional:!0,description:"window.PERSISTENT or window.TEMPORARY. Defaults to PERSISTENT."}},m.Html5LfsFile=f,i.add("html5Lfs",m),m}),t("skylark-data-files/providers/http/xhr",["skylark-langx-binary/buffer","../../error-codes","../../file-error","../../utils"],function(t,e,r,i){"use strict";const{isIE:n,emptyBuffer:s}=i,o="undefined"!=typeof XMLHttpRequest&&null!==XMLHttpRequest;function a(t,i,n){const s=new XMLHttpRequest;s.open("HEAD",i,t),s.onreadystatechange=function(t){if(4===s.readyState){if(200!==s.status)return n(new r(e.EIO,`XHR HEAD error: response returned code ${s.status}`));try{return n(null,parseInt(s.getResponseHeader("Content-Length")||"-1",10))}catch(t){return n(new r(e.EIO,"XHR HEAD error: Could not read content-length."))}}},s.send()}let c=function(i,n,o){const a=new XMLHttpRequest;a.open("GET",i,!0);let c=!0;switch(n){case"buffer":a.responseType="arraybuffer";break;case"json":try{a.responseType="json",c="json"===a.responseType}catch(t){c=!1}break;default:return o(new r(e.EINVAL,"Invalid download type: "+n))}a.onreadystatechange=function(i){if(4===a.readyState){if(200!==a.status)return o(new r(e.EIO,`XHR error: response returned code ${a.status}`));switch(n){case"buffer":return o(null,a.response?t.from(a.response):s());case"json":return o(null,c?a.response:JSON.parse(a.responseText))}}},a.send()},l=n&&"undefined"!=typeof Blob?function(i,n){const s=new XMLHttpRequest;switch(s.open("GET",i,!1),n){case"buffer":s.responseType="arraybuffer";break;case"json":break;default:throw new r(e.EINVAL,"Invalid download type: "+n)}let o,a;if(s.onreadystatechange=function(i){if(4===s.readyState)if(200===s.status)switch(n){case"buffer":o=t.from(s.response);break;case"json":o=JSON.parse(s.response)}else a=new r(e.EIO,`XHR error: response returned code ${s.status}`)},s.send(),a)throw a;return o}:function(i,n){const s=new XMLHttpRequest;s.open("GET",i,!1);let o=null,a=null;if(s.overrideMimeType("text/plain; charset=x-user-defined"),s.onreadystatechange=function(i){if(4===s.readyState){if(200!==s.status)return void(a=new r(e.EIO,`XHR error: response returned code ${s.status}`));switch(n){case"buffer":const e=s.responseText;o=t.alloc(e.length);for(let t=0;t<e.length;t++)o[t]=e.charCodeAt(t);return;case"json":return void(o=JSON.parse(s.responseText))}}},s.send(),a)throw a;return o};return{xhrIsAvailable:o,asyncDownloadFile:c,syncDownloadFile:l,getFileSizeSync:function(t){let e=-1;return a(!1,t,function(t,r){if(t)throw t;e=r}),e},getFileSizeAsync:function(t,e){a(!0,t,e)}}}),t("skylark-data-files/providers/http/fetch",["skylark-langx-binary/buffer","../../error-codes","../../file-error"],function(t,e,r){"use strict";const i="undefined"!=typeof fetch&&null!==fetch;return{fetchIsAvailable:i,fetchFileAsync:function(i,n,s){let o;try{o=fetch(i)}catch(t){return s(new r(e.EINVAL,t.message))}o.then(i=>{if(!i.ok)return s(new r(e.EIO,`fetch error: response returned code ${i.status}`));switch(n){case"buffer":i.arrayBuffer().then(e=>s(null,t.from(e))).catch(t=>s(new r(e.EIO,t.message)));break;case"json":i.json().then(t=>s(null,t)).catch(t=>s(new r(e.EIO,t.message)));break;default:s(new r(e.EINVAL,"Invalid download type: "+n))}}).catch(t=>s(new r(e.EIO,t.message)))},fetchFileSizeAsync:function(t,i){fetch(t,{method:"HEAD"}).then(t=>t.ok?i(null,parseInt(t.headers.get("Content-Length")||"-1",10)):i(new r(e.EIO,`fetch HEAD error: response returned code ${t.status}`))).catch(t=>i(new r(e.EIO,t.message)))}}}),t("skylark-data-files/inodes/dir-inode",["skylark-langx-paths","../stats","../file-type"],function(t,e,r){"use strict";class i{constructor(t=null){this.data=t,this._ls={}}isFile(){return!1}isDir(){return!0}getData(){return this.data}getStats(){return new e(r.DIRECTORY,4096,365)}getListing(){return Object.keys(this._ls)}getItem(t){const e=this._ls[t];return e||null}addItem(t,e){return!(t in this._ls)&&(this._ls[t]=e,!0)}remItem(t){const e=this._ls[t];return void 0===e?null:(delete this._ls[t],e)}}return i.isDirInode=function(t){return!!t&&t.isDir()},i}),t("skylark-data-files/inodes/file-inode",[],function(){"use strict";class t{constructor(t){this.data=t}isFile(){return!0}isDir(){return!1}getData(){return this.data}setData(t){this.data=t}}return t.isFileInode=function(t){return!!t&&t.isFile()},t}),t("skylark-data-files/inodes/file-index",["skylark-langx-paths","../stats","../file-type","./dir-inode","./file-inode"],function(t,e,r,i,n){"use strict";class s{constructor(){this._index={},this.addPath("/",new i)}static fromListing(t){const o=new s,a=new i;o._index["/"]=a;const c=[["",t,a]];for(;c.length>0;){let t;const s=c.pop(),a=s[0],l=s[1],h=s[2];for(const s in l)if(l.hasOwnProperty(s)){const u=l[s],f=`${a}/${s}`;u?(o._index[f]=t=new i,c.push([f,u,t])):t=new n(new e(r.FILE,-1,365)),h&&(h._ls[s]=t)}}return o}fileIterator(t){for(const e in this._index)if(this._index.hasOwnProperty(e)){const r=this._index[e],i=r.getListing();for(const e of i){const i=r.getItem(e);n.isFileInode(i)&&t(i.getData())}}}addPath(t,e){if(!e)throw new Error("Inode must be specified");if("/"!==t[0])throw new Error("Path must be absolute, got: "+t);if(this._index.hasOwnProperty(t))return this._index[t]===e;const r=this._split_path(t),n=r[0],s=r[1];let o=this._index[n];return!(void 0===o&&"/"!==t&&(o=new i,!this.addPath(n,o)))&&(!("/"!==t&&!o.addItem(s,e))&&(i.isDirInode(e)&&(this._index[t]=e),!0))}addPathFast(t,e){const r=t.lastIndexOf("/"),n=0===r?"/":t.substring(0,r),s=t.substring(r+1);let o=this._index[n];return void 0===o&&(o=new i,this.addPathFast(n,o)),!!o.addItem(s,e)&&(e.isDir()&&(this._index[t]=e),!0)}removePath(t){const e=this._split_path(t),r=e[0],n=e[1],s=this._index[r];if(void 0===s)return null;const o=s.remItem(n);if(null===o)return null;if(i.isDirInode(o)){const e=o.getListing();for(const r of e)this.removePath(t+"/"+r);"/"!==t&&delete this._index[t]}return o}ls(t){const e=this._index[t];return void 0===e?null:e.getListing()}getInode(t){const e=this._split_path(t),r=e[0],i=e[1],n=this._index[r];return void 0===n?null:r===t?n:n.getItem(i)}_split_path(e){const r=t.dirname(e),i=e.substr(r.length+("/"===r?0:1));return[r,i]}}return s}),t("skylark-data-files/providers/http/http-provider",["skylark-langx-async","skylark-langx-paths","../../files","../registry","../../no-sync-file","../base-provider","../../error-codes","../../file-error","../../action-type","../../stats","../../file-type","../../utils","./xhr","./fetch","../../inodes/dir-inode","../../inodes/file-index","../../inodes/file-inode"],function(t,e,r,i,n,s,o,a,c,l,h,u,f,d,y,p,w){"use strict";const{copyingSlice:g}=u,{xhrIsAvailable:m,asyncDownloadFile:E,syncDownloadFile:S,getFileSizeAsync:b,getFileSizeSync:_}=f,{fetchIsAvailable:k,fetchFileAsync:v,fetchFileSizeAsync:I}=d,N=w.isFileInode,O=y.isDirInode;function T(){throw new a(o.ENOTSUP,"Synchronous HTTP download methods are not available in this environment.")}class F extends s{constructor(t,e="",r=!1){super(),e.length>0&&"/"!==e.charAt(e.length-1)&&(e+="/"),this.prefixUrl=e,this._index=p.fromListing(t),!k||r&&m?(this._requestFileAsyncInternal=E,this._requestFileSizeAsyncInternal=b):(this._requestFileAsyncInternal=v,this._requestFileSizeAsyncInternal=I),m?(this._requestFileSyncInternal=S,this._requestFileSizeSyncInternal=_):(this._requestFileSyncInternal=T,this._requestFileSizeSyncInternal=T)}static Create(t,e){void 0===t.index&&(t.index="index.json"),"string"==typeof t.index?E(t.index,"json",(r,i)=>{r?e(r):e(null,new F(i,t.baseUrl))}):e(null,new F(t.index,t.baseUrl))}static isAvailable(){return m||k}empty(){this._index.fileIterator(function(t){t.fileData=null})}getName(){return F.Name}diskSpace(t,e){e(0,0)}isReadOnly(){return!0}supportsLinks(){return!1}supportsProps(){return!1}supportsSynch(){return m}preloadFile(t,e){const r=this._index.getInode(t);if(!N(r))throw a.EISDIR(t);{if(null===r)throw a.ENOENT(t);const i=r.getData();i.size=e.length,i.fileData=e}}stat(t,e,r){const i=this._index.getInode(t);if(null===i)return r(a.ENOENT(t));let n;N(i)?(n=i.getData()).size<0?this._requestFileSizeAsync(t,function(t,e){if(t)return r(t);n.size=e,r(null,l.clone(n))}):r(null,l.clone(n)):O(i)?(n=i.getStats(),r(null,n)):r(a.FileError(o.EINVAL,t))}statSync(t,e){const r=this._index.getInode(t);if(null===r)throw a.ENOENT(t);let i;if(N(r))(i=r.getData()).size<0&&(i.size=this._requestFileSizeSync(t));else{if(!O(r))throw a.FileError(o.EINVAL,t);i=r.getStats()}return i}open(t,e,r,i){if(e.isWriteable())return i(new a(o.EPERM,t));const s=this,h=this._index.getInode(t);if(null===h)return i(a.ENOENT(t));if(!N(h))return i(a.EISDIR(t));{const r=h.getData();switch(e.pathExistsAction()){case c.THROW_EXCEPTION:case c.TRUNCATE_FILE:return i(a.EEXIST(t));case c.NOP:if(r.fileData)return i(null,new n(s,t,e,l.clone(r),r.fileData));this._requestFileAsync(t,"buffer",function(o,a){return o?i(o):(r.size=a.length,r.fileData=a,i(null,new n(s,t,e,l.clone(r),a)))});break;default:return i(new a(o.EINVAL,"Invalid FileMode object."))}}}openSync(t,e,r){if(e.isWriteable())throw new a(o.EPERM,t);const i=this._index.getInode(t);if(null===i)throw a.ENOENT(t);if(!N(i))throw a.EISDIR(t);{const r=i.getData();switch(e.pathExistsAction()){case c.THROW_EXCEPTION:case c.TRUNCATE_FILE:throw a.EEXIST(t);case c.NOP:if(r.fileData)return new n(this,t,e,l.clone(r),r.fileData);const i=this._requestFileSync(t,"buffer");return r.size=i.length,r.fileData=i,new n(this,t,e,l.clone(r),i);default:throw new a(o.EINVAL,"Invalid FileMode object.")}}}readdir(t,e){try{e(null,this.readdirSync(t))}catch(t){e(t)}}readdirSync(t){const e=this._index.getInode(t);if(null===e)throw a.ENOENT(t);if(O(e))return e.getListing();throw a.ENOTDIR(t)}readFile(t,e,r,i){const n=i;this.open(t,r,420,function(t,r){if(t)return i(t);i=function(t,e){r.close(function(r){return t||(t=r),n(t,e)})};const s=r,o=s.getBuffer();null===e?i(t,g(o)):function(t,e,r){try{r(null,t.toString(e))}catch(t){r(t)}}(o,e,i)})}readFileSync(t,e,r){const i=this.openSync(t,r,420);try{const t=i,r=t.getBuffer();return null===e?g(r):r.toString(e)}finally{i.closeSync()}}_getHTTPPath(t){return"/"===t.charAt(0)&&(t=t.slice(1)),this.prefixUrl+t}_requestFileAsync(t,e,r){this._requestFileAsyncInternal(this._getHTTPPath(t),e,r)}_requestFileSync(t,e){return this._requestFileSyncInternal(this._getHTTPPath(t),e)}_requestFileSizeAsync(t,e){this._requestFileSizeAsyncInternal(this._getHTTPPath(t),e)}_requestFileSizeSync(t){return this._requestFileSizeSyncInternal(this._getHTTPPath(t))}}return F.Name="http",F.Options={index:{type:["string","object"],optional:!0,description:"URL to a file index as a JSON file or the file index object itself, generated with the make_http_index script. Defaults to `index.json`."},baseUrl:{type:"string",optional:!0,description:"Used as the URL prefix for fetched files. Default: Fetch files relative to the index."},preferXHR:{type:"boolean",optional:!0,description:"Whether to prefer XmlHttpRequest or fetch for async operations if both are available. Default: false"}},i.add("http",F),r.providers.HttpProvider=F}),t("skylark-data-files/inodes/inode",["skylark-langx-binary/buffer","../stats","../file-type"],function(t,e,r){"use strict";class i{constructor(t,e,r,i,n,s){this.id=t,this.size=e,this.mode=r,this.atime=i,this.mtime=n,this.ctime=s}static fromBuffer(t){if(void 0===t)throw new Error("NO");return new i(t.toString("ascii",30),t.readUInt32LE(0),t.readUInt16LE(4),t.readDoubleLE(6),t.readDoubleLE(14),t.readDoubleLE(22))}toStats(){return new e((61440&this.mode)===r.DIRECTORY?r.DIRECTORY:r.FILE,this.size,this.mode,this.atime,this.mtime,this.ctime)}getSize(){return 30+this.id.length}toBuffer(e=t.alloc(this.getSize())){return e.writeUInt32LE(this.size,0),e.writeUInt16LE(this.mode,4),e.writeDoubleLE(this.atime,6),e.writeDoubleLE(this.mtime,14),e.writeDoubleLE(this.ctime,22),e.write(this.id,30,this.id.length,"ascii"),e}update(t){let e=!1;this.size!==t.size&&(this.size=t.size,e=!0),this.mode!==t.mode&&(this.mode=t.mode,e=!0);const r=t.atime.getTime();this.atime!==r&&(this.atime=r,e=!0);const i=t.mtime.getTime();this.mtime!==i&&(this.mtime=i,e=!0);const n=t.ctime.getTime();return this.ctime!==n&&(this.ctime=n,e=!0),e}isFile(){return(61440&this.mode)===r.FILE}isDirectory(){return(61440&this.mode)===r.DIRECTORY}}return i}),t("skylark-data-files/providers/async-key-value-file",["../files","../preload-file"],function(t,e){"use strict";return t.providers.AsyncKeyValueFile=class extends e{constructor(t,e,r,i,n){super(t,e,r,i,n)}sync(t){this.isDirty()?this._fs._sync(this.getPath(),this.getBuffer(),this.getStats(),e=>{e||this.resetDirty(),t(e)}):t()}close(t){this.sync(t)}}}),t("skylark-data-files/providers/async-key-value-provider",["skylark-langx-strings/generate-uuid","skylark-langx-binary/buffer","skylark-langx-paths","skylark-data-collections/lru-cache","../files","../error-codes","../file-error","../file-type","../utils","../inodes/inode","./base-provider","./async-key-value-file"],function(t,e,r,i,n,s,o,a,c,l,h,u){"use strict";const{emptyBuffer:f}=c,d="/";let y=null;function p(t,e){return!t||(e(t),!1)}function w(t,e,r){return!t||(e.abort(()=>{r(t)}),!1)}return n.providers.AsyncKeyValueProvider=class extends h{constructor(t){super(),this._cache=null,t>0&&(this._cache=new i(t))}static isAvailable(){return!0}init(t,e){this.store=t,this.makeRootDirectory(e)}getName(){return this.store.name()}isReadOnly(){return!1}supportsSymlinks(){return!1}supportsProps(){return!1}supportsSynch(){return!1}empty(t){this._cache&&this._cache.removeAll(),this.store.clear(e=>{p(e,t)&&this.makeRootDirectory(t)})}rename(t,i,n){if(this._cache){const t=this._cache;this._cache=null,t.removeAll();const e=n;n=(r=>{this._cache=t,e(r)})}const a=this.store.beginTransaction("readwrite"),c=r.dirname(t),l=r.basename(t),h=r.dirname(i),u=r.basename(i),f={},d={};let y=!1;if(0===(h+"/").indexOf(t+"/"))return n(new o(s.EBUSY,c));const p=()=>{if(y||!d.hasOwnProperty(c)||!d.hasOwnProperty(h))return;const r=d[c],s=f[c],p=d[h],g=f[h];if(r[l]){const t=r[l];delete r[l];const f=()=>{p[u]=t,a.put(s.id,e.from(JSON.stringify(r)),!0,t=>{w(t,a,n)&&(c===h?a.commit(n):a.put(g.id,e.from(JSON.stringify(p)),!0,t=>{w(t,a,n)&&a.commit(n)}))})};p[u]?this.getINode(a,i,p[u],(t,e)=>{w(t,a,n)&&(e.isFile()?a.del(e.id,t=>{w(t,a,n)&&a.del(p[u],t=>{w(t,a,n)&&f()})}):a.abort(t=>{n(o.EPERM(i))}))}):f()}else n(o.ENOENT(t))},g=t=>{this.findINodeAndDirListing(a,t,(e,r,i)=>{e?y||(y=!0,a.abort(()=>{n(e)})):(f[t]=r,d[t]=i,p())})};g(c),c!==h&&g(h)}stat(t,e,r){const i=this.store.beginTransaction("readonly");this.findINode(i,t,(t,e)=>{p(t,r)&&r(null,e.toStats())})}createFile(t,e,r,i){const n=this.store.beginTransaction("readwrite"),s=f();this.commitNewFile(n,t,a.FILE,r,s,(r,n)=>{p(r,i)&&i(null,new u(this,t,e,n.toStats(),s))})}openFile(t,e,r){const i=this.store.beginTransaction("readonly");this.findINode(i,t,(n,s)=>{p(n,r)&&i.get(s.id,(i,n)=>{p(i,r)&&(void 0===n?r(o.ENOENT(t)):r(null,new u(this,t,e,s.toStats(),n)))})})}unlink(t,e){this.removeEntry(t,!1,e)}rmdir(t,e){this.readdir(t,(r,i)=>{r?e(r):i.length>0?e(o.ENOTEMPTY(t)):this.removeEntry(t,!0,e)})}mkdir(t,r,i){const n=this.store.beginTransaction("readwrite"),s=e.from("{}");this.commitNewFile(n,t,a.DIRECTORY,r,s,i)}readdir(t,e){const r=this.store.beginTransaction("readonly");this.findINode(r,t,(i,n)=>{p(i,e)&&this.getDirListing(r,t,n,(t,r)=>{p(t,e)&&e(null,Object.keys(r))})})}_sync(t,e,i,n){const s=this.store.beginTransaction("readwrite");this._findINode(s,r.dirname(t),r.basename(t),(r,o)=>{w(r,s,n)&&this.getINode(s,t,o,(t,r)=>{if(w(t,s,n)){const t=r.update(i);s.put(r.id,e,!0,e=>{w(e,s,n)&&(t?s.put(o,r.toBuffer(),!0,t=>{w(t,s,n)&&s.commit(n)}):s.commit(n))})}})})}makeRootDirectory(r){const i=this.store.beginTransaction("readwrite");i.get(d,(n,s)=>{if(n||void 0===s){const n=(new Date).getTime(),s=new l(t(),4096,511|a.DIRECTORY,n,n,n);i.put(s.id,function(){if(y)return y;return y=e.from("{}")}(),!1,t=>{w(t,i,r)&&i.put(d,s.toBuffer(),!1,t=>{t?i.abort(()=>{r(t)}):i.commit(r)})})}else i.commit(r)})}_findINode(t,e,i,n){if(this._cache){const t=this._cache.get(r.join(e,i));if(t)return n(null,t)}const s=(t,s,a)=>{if(t)n(t);else if(a[i]){const t=a[i];this._cache&&this._cache.set(r.join(e,i),t),n(null,t)}else n(o.ENOENT(r.resolve(e,i)))};"/"===e?""===i?(this._cache&&this._cache.set(r.join(e,i),d),n(null,d)):this.getINode(t,e,d,(r,i)=>{p(r,n)&&this.getDirListing(t,e,i,(t,e)=>{s(t,i,e)})}):this.findINodeAndDirListing(t,e,s)}findINode(t,e,i){this._findINode(t,r.dirname(e),r.basename(e),(r,n)=>{p(r,i)&&this.getINode(t,e,n,i)})}getINode(t,e,r,i){t.get(r,(t,r)=>{p(t,i)&&(void 0===r?i(o.ENOENT(e)):i(null,l.fromBuffer(r)))})}getDirListing(t,e,r,i){r.isDirectory()?t.get(r.id,(t,r)=>{if(p(t,i))try{i(null,JSON.parse(r.toString()))}catch(t){i(o.ENOENT(e))}}):i(o.ENOTDIR(e))}findINodeAndDirListing(t,e,r){this.findINode(t,e,(i,n)=>{p(i,r)&&this.getDirListing(t,e,n,(t,e)=>{p(t,r)&&r(null,n,e)})})}addNewNode(e,r,i){let n,a=0;const c=()=>{5==++a?i(new o(s.EIO,"Unable to commit data to key-value store.")):(n=t(),e.put(n,r,!1,(t,e)=>{t||!e?c():i(null,n)}))};c()}commitNewFile(t,i,n,s,a,c){const h=r.dirname(i),u=r.basename(i),f=(new Date).getTime();if("/"===i)return c(o.EEXIST(i));this.findINodeAndDirListing(t,h,(r,h,d)=>{w(r,t,c)&&(d[u]?t.abort(()=>{c(o.EEXIST(i))}):this.addNewNode(t,a,(r,i)=>{if(w(r,t,c)){const r=new l(i,a.length,s|n,f,f,f);this.addNewNode(t,r.toBuffer(),(i,n)=>{w(i,t,c)&&(d[u]=n,t.put(h.id,e.from(JSON.stringify(d)),!0,e=>{w(e,t,c)&&t.commit(e=>{w(e,t,c)&&c(null,r)})}))})}}))})}removeEntry(t,i,n){this._cache&&this._cache.remove(t);const s=this.store.beginTransaction("readwrite"),a=r.dirname(t),c=r.basename(t);this.findINodeAndDirListing(s,a,(r,a,l)=>{if(w(r,s,n))if(l[c]){const r=l[c];delete l[c],this.getINode(s,t,r,(c,h)=>{w(c,s,n)&&(!i&&h.isDirectory()?s.abort(()=>{n(o.EISDIR(t))}):i&&!h.isDirectory()?s.abort(()=>{n(o.ENOTDIR(t))}):s.del(h.id,t=>{w(t,s,n)&&s.del(r,t=>{w(t,s,n)&&s.put(a.id,e.from(JSON.stringify(l)),!0,t=>{w(t,s,n)&&s.commit(n)})})}))})}else s.abort(()=>{n(o.ENOENT(t))})})}}}),t("skylark-data-files/providers/indexeddb/indexed-db-ro-transaction",["../../file-error","../../error-codes","../async-key-value-provider","../../utils"],function(t,e,r,i){"use strict";const{arrayBuffer2Buffer:n,buffer2ArrayBuffer:s}=i;return class{constructor(t,e){this.tx=t,this.store=e}get(r,i){try{const s=this.store.get(r);s.onerror=function(r,i=e.EIO,n=null){return function(e){e.preventDefault(),r(new t(i,null!==n?n:void 0))}}(i),s.onsuccess=(t=>{const e=t.target.result;i(null,void 0===e?e:n(e))})}catch(r){i(function(r,i=r.toString()){switch(r.name){case"NotFoundError":return new t(e.ENOENT,i);case"QuotaExceededError":return new t(e.ENOSPC,i);default:return new t(e.EIO,i)}}(r))}}}}),t("skylark-data-files/providers/indexeddb/indexed-db-rw-transaction",["../../file-error","../../error-codes","../async-key-value-provider","../../utils","./indexed-db-ro-transaction"],function(t,e,r,i,n){"use strict";const{arrayBuffer2Buffer:s,buffer2ArrayBuffer:o}=i;window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;function a(r,i=r.toString()){switch(r.name){case"NotFoundError":return new t(e.ENOENT,i);case"QuotaExceededError":return new t(e.ENOSPC,i);default:return new t(e.EIO,i)}}function c(r,i=e.EIO,n=null){return function(e){e.preventDefault(),r(new t(i,null!==n?n:void 0))}}return class extends n{constructor(t,e){super(t,e)}put(t,e,r,i){try{const n=o(e);let s;(s=r?this.store.put(n,t):this.store.add(n,t)).onerror=c(i),s.onsuccess=(t=>{i(null,!0)})}catch(t){i(a(t))}}del(t,e){try{const r=this.store.delete(t);r.onerror=c(e),r.onsuccess=(t=>{e()})}catch(t){e(a(t))}}commit(t){setTimeout(t,0)}abort(t){let e=null;try{this.tx.abort()}catch(t){e=a(t)}finally{t(e)}}}}),t("skylark-data-files/providers/indexeddb/indexed-db-store",["../../file-error","../../error-codes","./indexed-db-ro-transaction","./indexed-db-rw-transaction"],function(t,e,r,i){"use strict";function n(r,i=e.EIO,n=null){return function(e){e.preventDefault(),r(new t(i,null!==n?n:void 0))}}class s{constructor(t,e){this.db=t,this.storeName=e}static Create(t,r){const i=indexedDB.open(t,1);i.onupgradeneeded=(e=>{const r=e.target.result;r.objectStoreNames.contains(t)&&r.deleteObjectStore(t),r.createObjectStore(t)}),i.onsuccess=(e=>{r(null,new s(e.target.result,t))}),i.onerror=n(r,e.EACCES)}name(){return IndexedDBProvider.Name+" - "+this.storeName}clear(r){try{const i=this.db.transaction(this.storeName,"readwrite"),s=i.objectStore(this.storeName),o=s.clear();o.onsuccess=(t=>{setTimeout(r,0)}),o.onerror=n(r)}catch(i){r(function(r,i=r.toString()){switch(r.name){case"NotFoundError":return new t(e.ENOENT,i);case"QuotaExceededError":return new t(e.ENOSPC,i);default:return new t(e.EIO,i)}}(i))}}beginTransaction(n="readonly"){const s=this.db.transaction(this.storeName,n),o=s.objectStore(this.storeName);if("readwrite"===n)return new i(s,o);if("readonly"===n)return new r(s,o);throw new t(e.EINVAL,"Invalid transaction type.")}}return s}),t("skylark-data-files/providers/indexeddb/indexed-db-provider",["../../files","../../file-error","../../error-codes","../async-key-value-provider","../registry","../../utils","./indexed-db-store","./indexed-db-ro-transaction","./indexed-db-rw-transaction"],function(t,e,r,i,n,s,o,a,c){"use strict";const l=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;class h extends i{constructor(t){super(t)}static Create(t={},e){o.Create(t.storeName?t.storeName:"browserfs",(r,i)=>{if(i){const r=new h("number"==typeof t.cacheSize?t.cacheSize:100);r.init(i,t=>{t?e(t):e(null,r)})}else e(r)})}static isAvailable(){try{return void 0!==l&&null!==l.open("__browserfs_test__")}catch(t){return!1}}}return h.Name="IndexedDB",h.Options={storeName:{type:"string",optional:!0,description:"The name of this file system. You can have multiple IndexedDB file systems operating at once, but each must have a different name."},cacheSize:{type:"number",optional:!0,description:"The size of the inode cache. Defaults to 100. A size of 0 or below disables caching."}},h.IndexedDBROTransaction=a,h.IndexedDBRWTransaction=c,h.IndexedDBStore=o,n.add("indexedDB",h),t.providers.IndexedDBProvider=h}),t("skylark-data-files/providers/synchronous-provider",["skylark-langx-binary/buffer","skylark-langx-paths","../files","../error-codes","../file-error","../action-type","../file-flag","../utils","./base-provider"],function(t,e,r,i,n,s,o,a,c){"use strict";const{fail:l}=a;return r.providers.SynchronousProvider=class extends c{supportsSynch(){return!0}rename(t,e,r){try{this.renameSync(t,e),r()}catch(t){r(t)}}stat(t,e,r){try{r(null,this.statSync(t,e))}catch(t){r(t)}}open(t,e,r,i){try{i(null,this.openSync(t,e,r))}catch(t){i(t)}}unlink(t,e){try{this.unlinkSync(t),e()}catch(t){e(t)}}rmdir(t,e){try{this.rmdirSync(t),e()}catch(t){e(t)}}mkdir(t,e,r){try{this.mkdirSync(t,e),r()}catch(t){r(t)}}readdir(t,e){try{e(null,this.readdirSync(t))}catch(t){e(t)}}chmod(t,e,r,i){try{this.chmodSync(t,e,r),i()}catch(t){i(t)}}chown(t,e,r,i,n){try{this.chownSync(t,e,r,i),n()}catch(t){n(t)}}utimes(t,e,r,i){try{this.utimesSync(t,e,r),i()}catch(t){i(t)}}link(t,e,r){try{this.linkSync(t,e),r()}catch(t){r(t)}}symlink(t,e,r,i){try{this.symlinkSync(t,e,r),i()}catch(t){i(t)}}readlink(t,e){try{e(null,this.readlinkSync(t))}catch(t){e(t)}}}}),t("skylark-data-files/providers/sync-key-value-provider",["skylark-langx-strings/generate-uuid","skylark-langx-binary/buffer","skylark-langx-paths","../files","../error-codes","../file-error","./base-provider","./synchronous-provider","../utils"],function(t,e,r,i,n,s,o,a,c){"use strict";const{emptyBuffer:l}=c;return i.providers.SyncKeyValueProvider=class extends a{static isAvailable(){return!0}constructor(t){super(),this.store=t.store,this.makeRootDirectory()}getName(){return this.store.name()}isReadOnly(){return!1}supportsSymlinks(){return!1}supportsProps(){return!1}supportsSynch(){return!0}empty(){this.store.clear(),this.makeRootDirectory()}renameSync(t,i){const o=this.store.beginTransaction("readwrite"),a=r.dirname(t),c=r.basename(t),l=r.dirname(i),h=r.basename(i),u=this.findINode(o,a),f=this.getDirListing(o,a,u);if(!f[c])throw s.ENOENT(t);const d=f[c];if(delete f[c],0===(l+"/").indexOf(t+"/"))throw new s(n.EBUSY,a);let y,p;if(l===a?(y=u,p=f):(y=this.findINode(o,l),p=this.getDirListing(o,l,y)),p[h]){const t=this.getINode(o,i,p[h]);if(!t.isFile())throw s.EPERM(i);try{o.del(t.id),o.del(p[h])}catch(t){throw o.abort(),t}}p[h]=d;try{o.put(u.id,e.from(JSON.stringify(f)),!0),o.put(y.id,e.from(JSON.stringify(p)),!0)}catch(t){throw o.abort(),t}o.commit()}statSync(t,e){return this.findINode(this.store.beginTransaction("readonly"),t).toStats()}createFileSync(t,e,r){const i=this.store.beginTransaction("readwrite"),n=l(),s=this.commitNewFile(i,t,FileType.FILE,r,n);return new SyncKeyValueFile(this,t,e,s.toStats(),n)}openFileSync(t,e){const r=this.store.beginTransaction("readonly"),i=this.findINode(r,t),n=r.get(i.id);if(void 0===n)throw s.ENOENT(t);return new SyncKeyValueFile(this,t,e,i.toStats(),n)}unlinkSync(t){this.removeEntry(t,!1)}rmdirSync(t){if(this.readdirSync(t).length>0)throw s.ENOTEMPTY(t);this.removeEntry(t,!0)}mkdirSync(t,r){const i=this.store.beginTransaction("readwrite"),n=e.from("{}");this.commitNewFile(i,t,FileType.DIRECTORY,r,n)}readdirSync(t){const e=this.store.beginTransaction("readonly");return Object.keys(this.getDirListing(e,t,this.findINode(e,t)))}_syncSync(t,e,i){const n=this.store.beginTransaction("readwrite"),s=this._findINode(n,r.dirname(t),r.basename(t)),o=this.getINode(n,t,s),a=o.update(i);try{n.put(o.id,e,!0),a&&n.put(s,o.toBuffer(),!0)}catch(t){throw n.abort(),t}n.commit()}makeRootDirectory(){const e=this.store.beginTransaction("readwrite");if(void 0===e.get(ROOT_NODE_ID)){const r=(new Date).getTime(),i=new Inode(t(),4096,511|FileType.DIRECTORY,r,r,r);e.put(i.id,getEmptyDirNode(),!1),e.put(ROOT_NODE_ID,i.toBuffer(),!1),e.commit()}}_findINode(t,e,i){const n=n=>{const o=this.getDirListing(t,e,n);if(o[i])return o[i];throw s.ENOENT(r.resolve(e,i))};return"/"===e?""===i?ROOT_NODE_ID:n(this.getINode(t,e,ROOT_NODE_ID)):n(this.getINode(t,e+r.sep+i,this._findINode(t,r.dirname(e),r.basename(e))))}findINode(t,e){return this.getINode(t,e,this._findINode(t,r.dirname(e),r.basename(e)))}getINode(t,e,r){const i=t.get(r);if(void 0===i)throw s.ENOENT(e);return Inode.fromBuffer(i)}getDirListing(t,e,r){if(!r.isDirectory())throw s.ENOTDIR(e);const i=t.get(r.id);if(void 0===i)throw s.ENOENT(e);return JSON.parse(i.toString())}addNewNode(e,r){let i;for(;;)try{return i=t(),e.put(i,r,!1),i}catch(t){}throw new s(n.EIO,"Unable to commit data to key-value store.")}commitNewFile(t,i,n,o,a){const c=r.dirname(i),l=r.basename(i),h=this.findINode(t,c),u=this.getDirListing(t,c,h),f=(new Date).getTime();if("/"===i)throw s.EEXIST(i);if(u[l])throw s.EEXIST(i);let d;try{const r=this.addNewNode(t,a);d=new Inode(r,a.length,o|n,f,f,f);const i=this.addNewNode(t,d.toBuffer());u[l]=i,t.put(h.id,e.from(JSON.stringify(u)),!0)}catch(e){throw t.abort(),e}return t.commit(),d}removeEntry(t,i){const n=this.store.beginTransaction("readwrite"),o=r.dirname(t),a=this.findINode(n,o),c=this.getDirListing(n,o,a),l=r.basename(t);if(!c[l])throw s.ENOENT(t);const h=c[l];delete c[l];const u=this.getINode(n,t,h);if(!i&&u.isDirectory())throw s.EISDIR(t);if(i&&!u.isDirectory())throw s.ENOTDIR(t);try{n.del(u.id),n.del(h),n.put(a.id,e.from(JSON.stringify(c)),!0)}catch(t){throw n.abort(),t}n.commit()}}}),t("skylark-data-files/providers/simple-sync-rw-transaction",["../files","../error-codes","../file-error"],function(t,e,r){"use strict";return t.providers.SimpleSyncRWTransaction=class{constructor(t){this.store=t,this.originalData={},this.modifiedKeys=[]}get(t){const e=this.store.get(t);return this.stashOldValue(t,e),e}put(t,e,r){return this.markModified(t),this.store.put(t,e,r)}del(t){this.markModified(t),this.store.del(t)}commit(){}abort(){for(const t of this.modifiedKeys){const e=this.originalData[t];e?this.store.put(t,e,!0):this.store.del(t)}}stashOldValue(t,e){this.originalData.hasOwnProperty(t)||(this.originalData[t]=e)}markModified(t){-1===this.modifiedKeys.indexOf(t)&&(this.modifiedKeys.push(t),this.originalData.hasOwnProperty(t)||(this.originalData[t]=this.store.get(t)))}}}),t("skylark-data-files/providers/inmemory/in-memory-store",["../simple-sync-rw-transaction"],function(t){"use strict";return class{constructor(){this.store={}}clear(){this.store={}}beginTransaction(e){return new t(this)}get(t){return this.store[t]}put(t,e,r){return!(!r&&this.store.hasOwnProperty(t))&&(this.store[t]=e,!0)}del(t){delete this.store[t]}}}),t("skylark-data-files/providers/inmemory/in-memory-provider",["../../files","../registry","../sync-key-value-provider","./in-memory-store"],function(t,e,r,i){"use strict";class n extends r{name(){return n.Name}constructor(){super({store:new i})}static Create(t,e){e(null,new n)}}return n.Name="InMemory",n.Options={},n.InMemoryStore=i,e.add("inMemory",n),t.providers.InMemoryProvider=n}),t("skylark-data-files/providers/localstorage/local-storage-store",["skylark-langx-binary/buffer","../simple-sync-rw-transaction","../../error-codes","../../file-error"],function(t,e,r,i){"use strict";return class{name(){return LocalStorageProvider.Name}clear(){window.localStorage.clear()}beginTransaction(t){return new e(this)}get(e){try{const r=window.localStorage.getItem(e);if(null!==r)return t.from(r,binaryEncoding)}catch(t){}}put(t,e,n){try{return!(!n&&null!==window.localStorage.getItem(t))&&(window.localStorage.setItem(t,e.toString(binaryEncoding)),!0)}catch(t){throw new i(r.ENOSPC,"LocalStorage is full.")}}del(t){try{window.localStorage.removeItem(t)}catch(e){throw new i(r.EIO,"Unable to delete key "+t+": "+e)}}}}),t("skylark-data-files/providers/localstorage/local-storage-provider",["skylark-langx-binary/buffer","../../files","../registry","../sync-key-value-provider","../../error-codes","../../file-error","./local-storage-store"],function(t,e,r,i,n,s,o){"use strict";let a,c=!1;try{window.localStorage.setItem("__test__",String.fromCharCode(55296)),c=window.localStorage.getItem("__test__")===String.fromCharCode(55296)}catch(t){c=!1}a=c?"binary_string":"binary_string_ie",t.isEncoding(a)||(a="base64");class l extends i{constructor(){super({store:new o})}static Create(t,e){e(null,new l)}static isAvailable(){return void 0!==window.localStorage}}return l.Name="LocalStorage",l.Options={},l.LocalStorageStore=o,r.add("localStorage",l),e.providers.LocalStorageProvider=l}),t("skylark-data-files/providers/mutex",["skylark-langx-funcs/defer"],function(t){"use strict";return class{constructor(){this._locked=!1,this._waiters=[]}lock(t){this._locked?this._waiters.push(t):(this._locked=!0,t())}unlock(){if(!this._locked)throw new Error("unlock of a non-locked mutex");const e=this._waiters.shift();e?t(e):this._locked=!1}tryLock(){return!this._locked&&(this._locked=!0,!0)}isLocked(){return this._locked}}}),t("skylark-data-files/providers/locked-provider",["../files","./mutex"],function(t,e){"use strict";return t.providers.LockedProvider=class{constructor(t){this._fs=t,this._mu=new e}getName(){return"LockedProvider<"+this._fs.getName()+">"}getFSUnlocked(){return this._fs}diskSpace(t,e){this._fs.diskSpace(t,e)}isReadOnly(){return this._fs.isReadOnly()}supportsLinks(){return this._fs.supportsLinks()}supportsProps(){return this._fs.supportsProps()}supportsSynch(){return this._fs.supportsSynch()}rename(t,e,r){this._mu.lock(()=>{this._fs.rename(t,e,t=>{this._mu.unlock(),r(t)})})}renameSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.renameSync(t,e)}stat(t,e,r){this._mu.lock(()=>{this._fs.stat(t,e,(t,e)=>{this._mu.unlock(),r(t,e)})})}statSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.statSync(t,e)}open(t,e,r,i){this._mu.lock(()=>{this._fs.open(t,e,r,(t,e)=>{this._mu.unlock(),i(t,e)})})}openSync(t,e,r){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.openSync(t,e,r)}unlink(t,e){this._mu.lock(()=>{this._fs.unlink(t,t=>{this._mu.unlock(),e(t)})})}unlinkSync(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.unlinkSync(t)}rmdir(t,e){this._mu.lock(()=>{this._fs.rmdir(t,t=>{this._mu.unlock(),e(t)})})}rmdirSync(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.rmdirSync(t)}mkdir(t,e,r){this._mu.lock(()=>{this._fs.mkdir(t,e,t=>{this._mu.unlock(),r(t)})})}mkdirSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.mkdirSync(t,e)}readdir(t,e){this._mu.lock(()=>{this._fs.readdir(t,(t,r)=>{this._mu.unlock(),e(t,r)})})}readdirSync(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readdirSync(t)}exists(t,e){this._mu.lock(()=>{this._fs.exists(t,t=>{this._mu.unlock(),e(t)})})}existsSync(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.existsSync(t)}realpath(t,e,r){this._mu.lock(()=>{this._fs.realpath(t,e,(t,e)=>{this._mu.unlock(),r(t,e)})})}realpathSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.realpathSync(t,e)}truncate(t,e,r){this._mu.lock(()=>{this._fs.truncate(t,e,t=>{this._mu.unlock(),r(t)})})}truncateSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.truncateSync(t,e)}readFile(t,e,r,i){this._mu.lock(()=>{this._fs.readFile(t,e,r,(t,e)=>{this._mu.unlock(),i(t,e)})})}readFileSync(t,e,r){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readFileSync(t,e,r)}writeFile(t,e,r,i,n,s){this._mu.lock(()=>{this._fs.writeFile(t,e,r,i,n,t=>{this._mu.unlock(),s(t)})})}writeFileSync(t,e,r,i,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.writeFileSync(t,e,r,i,n)}appendFile(t,e,r,i,n,s){this._mu.lock(()=>{this._fs.appendFile(t,e,r,i,n,t=>{this._mu.unlock(),s(t)})})}appendFileSync(t,e,r,i,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.appendFileSync(t,e,r,i,n)}chmod(t,e,r,i){this._mu.lock(()=>{this._fs.chmod(t,e,r,t=>{this._mu.unlock(),i(t)})})}chmodSync(t,e,r){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.chmodSync(t,e,r)}chown(t,e,r,i,n){this._mu.lock(()=>{this._fs.chown(t,e,r,i,t=>{this._mu.unlock(),n(t)})})}chownSync(t,e,r,i){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.chownSync(t,e,r,i)}utimes(t,e,r,i){this._mu.lock(()=>{this._fs.utimes(t,e,r,t=>{this._mu.unlock(),i(t)})})}utimesSync(t,e,r){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.utimesSync(t,e,r)}link(t,e,r){this._mu.lock(()=>{this._fs.link(t,e,t=>{this._mu.unlock(),r(t)})})}linkSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.linkSync(t,e)}symlink(t,e,r,i){this._mu.lock(()=>{this._fs.symlink(t,e,r,t=>{this._mu.unlock(),i(t)})})}symlinkSync(t,e,r){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.symlinkSync(t,e,r)}readlink(t,e){this._mu.lock(()=>{this._fs.readlink(t,(t,r)=>{this._mu.unlock(),e(t,r)})})}readlinkSync(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readlinkSync(t)}}}),t("skylark-data-files/providers/overlay/overlay-file",["../../preload-file"],function(t){return class extends t{constructor(t,e,r,i,n){super(t,e,r,i,n)}sync(t){this.isDirty()?this._fs._syncAsync(this,e=>{this.resetDirty(),t(e)}):t(null)}syncSync(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())}close(t){this.sync(t)}closeSync(){this.syncSync()}}}),t("skylark-data-files/providers/overlay/unlocked-overlay-provider",["skylark-langx-paths","../base-provider","../../stats","../../file-type","../../file-error","../../error-codes","../../file-flag","../../action-type","./overlay-file"],function(t,e,r,i,n,s,o,a,c){const l="/.deletedFiles.log";function h(t){return 146|t}function u(t){return o.getFileFlag(t)}return class extends e{constructor(t,e){if(super(),this._isInitialized=!1,this._initializeCallbacks=[],this._deletedFiles={},this._deleteLog="",this._deleteLogUpdatePending=!1,this._deleteLogUpdateNeeded=!1,this._deleteLogError=null,this._writable=t,this._readable=e,this._writable.isReadOnly())throw new n(s.EINVAL,"Writable file system must be writable.")}static isAvailable(){return!0}getOverlayedProviders(){return{readable:this._readable,writable:this._writable}}_syncAsync(t,e){this.createParentDirectoriesAsync(t.getPath(),r=>{if(r)return e(r);this._writable.writeFile(t.getPath(),t.getBuffer(),null,u("w"),t.getStats().mode,e)})}_syncSync(t){this.createParentDirectories(t.getPath()),this._writable.writeFileSync(t.getPath(),t.getBuffer(),null,u("w"),t.getStats().mode)}getName(){return OverlayFS.Name}_initialize(t){const e=this._initializeCallbacks,r=t=>{this._isInitialized=!t,this._initializeCallbacks=[],e.forEach(e=>e(t))};if(this._isInitialized)return t();e.push(t),1===e.length&&this._writable.readFile(l,"utf8",u("r"),(t,e)=>{if(t){if(t.errno!==s.ENOENT)return r(t)}else this._deleteLog=e;this._reparseDeletionLog(),r()})}isReadOnly(){return!1}supportsSynch(){return this._readable.supportsSynch()&&this._writable.supportsSynch()}supportsLinks(){return!1}supportsProps(){return this._readable.supportsProps()&&this._writable.supportsProps()}getDeletionLog(){return this._deleteLog}restoreDeletionLog(t){this._deleteLog=t,this._reparseDeletionLog(),this.updateLog("")}rename(e,r,i){if(this.checkInitAsync(i)&&!this.checkPathAsync(e,i)&&!this.checkPathAsync(r,i))return e===l||r===l?i(n.EPERM("Cannot rename deletion log.")):e===r?i():void this.stat(e,!1,(o,a)=>o?i(o):this.stat(r,!1,(o,c)=>{const l=this;function h(n){const s=n.shift();if(!s)return i();const o=t.resolve(e,s),a=t.resolve(r,s);l.rename(o,a,t=>{if(t)return i(t);h(n)})}let f=511;if(a.isDirectory()){if(o)return o.errno!==s.ENOENT?i(o):this._writable.exists(e,t=>{if(t)return this._writable.rename(e,r,i);this._writable.mkdir(r,f,t=>{if(t)return i(t);this._readable.readdir(e,(t,e)=>{if(t)return i();h(e)})})});if(f=c.mode,!c.isDirectory())return i(n.ENOTDIR(r));this.readdir(r,(t,s)=>{if(s&&s.length)return i(n.ENOTEMPTY(r));this._readable.readdir(e,(t,e)=>{if(t)return i();h(e)})})}if(c&&c.isDirectory())return i(n.EISDIR(r));this.readFile(e,null,u("r"),(t,n)=>t?i(t):this.writeFile(r,n,null,u("w"),a.mode,t=>t?i(t):this.unlink(e,i)))}))}renameSync(e,r){if(this.checkInitialized(),this.checkPath(e),this.checkPath(r),e===l||r===l)throw n.EPERM("Cannot rename deletion log.");const i=this.statSync(e,!1);if(i.isDirectory()){if(e===r)return;let i=511;if(this.existsSync(r)){const t=this.statSync(r,!1);if(i=t.mode,!t.isDirectory())throw n.ENOTDIR(r);if(this.readdirSync(r).length>0)throw n.ENOTEMPTY(r)}this._writable.existsSync(e)?this._writable.renameSync(e,r):this._writable.existsSync(r)||this._writable.mkdirSync(r,i),this._readable.existsSync(e)&&this._readable.readdirSync(e).forEach(i=>{this.renameSync(t.resolve(e,i),t.resolve(r,i))})}else{if(this.existsSync(r)&&this.statSync(r,!1).isDirectory())throw n.EISDIR(r);this.writeFileSync(r,this.readFileSync(e,null,u("r")),null,u("w"),i.mode)}e!==r&&this.existsSync(e)&&this.unlinkSync(e)}stat(t,e,i){this.checkInitAsync(i)&&this._writable.stat(t,e,(o,a)=>{o&&o.errno===s.ENOENT?(this._deletedFiles[t]&&i(n.ENOENT(t)),this._readable.stat(t,e,(t,e)=>{e&&((e=r.clone(e)).mode=h(e.mode)),i(t,e)})):i(o,a)})}statSync(t,e){this.checkInitialized();try{return this._writable.statSync(t,e)}catch(i){if(this._deletedFiles[t])throw n.ENOENT(t);const s=r.clone(this._readable.statSync(t,e));return s.mode=h(s.mode),s}}open(t,e,i,s){this.checkInitAsync(s)&&!this.checkPathAsync(t,s)&&this.stat(t,!1,(o,l)=>{if(l)switch(e.pathExistsAction()){case a.TRUNCATE_FILE:return this.createParentDirectoriesAsync(t,r=>{if(r)return s(r);this._writable.open(t,e,i,s)});case a.NOP:return this._writable.exists(t,n=>{n?this._writable.open(t,e,i,s):((l=r.clone(l)).mode=i,this._readable.readFile(t,null,u("r"),(r,i)=>{if(r)return s(r);-1===l.size&&(l.size=i.length);const n=new c(this,t,e,l,i);s(null,n)}))});default:return s(n.EEXIST(t))}else switch(e.pathNotExistsAction()){case a.CREATE_FILE:return this.createParentDirectoriesAsync(t,r=>r?s(r):this._writable.open(t,e,i,s));default:return s(n.ENOENT(t))}})}openSync(t,e,i){if(this.checkInitialized(),this.checkPath(t),t===l)throw n.EPERM("Cannot open deletion log.");if(this.existsSync(t))switch(e.pathExistsAction()){case a.TRUNCATE_FILE:return this.createParentDirectories(t),this._writable.openSync(t,e,i);case a.NOP:if(this._writable.existsSync(t))return this._writable.openSync(t,e,i);{const n=this._readable.readFileSync(t,null,u("r")),s=r.clone(this._readable.statSync(t,!1));return s.mode=i,new c(this,t,e,s,n)}default:throw n.EEXIST(t)}else switch(e.pathNotExistsAction()){case a.CREATE_FILE:return this.createParentDirectories(t),this._writable.openSync(t,e,i);default:throw n.ENOENT(t)}}unlink(t,e){this.checkInitAsync(e)&&!this.checkPathAsync(t,e)&&this.exists(t,r=>{if(!r)return e(n.ENOENT(t));this._writable.exists(t,r=>{if(r)return this._writable.unlink(t,r=>{if(r)return e(r);this.exists(t,r=>{r&&this.deletePath(t),e(null)})});this.deletePath(t),e(null)})})}unlinkSync(t){if(this.checkInitialized(),this.checkPath(t),!this.existsSync(t))throw n.ENOENT(t);this._writable.existsSync(t)&&this._writable.unlinkSync(t),this.existsSync(t)&&this.deletePath(t)}rmdir(t,e){if(!this.checkInitAsync(e))return;const r=()=>{this.readdir(t,(r,i)=>r?e(r):i.length?e(n.ENOTEMPTY(t)):(this.deletePath(t),void e(null)))};this.exists(t,i=>{if(!i)return e(n.ENOENT(t));this._writable.exists(t,i=>{i?this._writable.rmdir(t,i=>{if(i)return e(i);this._readable.exists(t,t=>{t?r():e()})}):r()})})}rmdirSync(t){if(this.checkInitialized(),!this.existsSync(t))throw n.ENOENT(t);if(this._writable.existsSync(t)&&this._writable.rmdirSync(t),this.existsSync(t)){if(this.readdirSync(t).length>0)throw n.ENOTEMPTY(t);this.deletePath(t)}}mkdir(t,e,r){this.checkInitAsync(r)&&this.exists(t,i=>{if(i)return r(n.EEXIST(t));this.createParentDirectoriesAsync(t,i=>{if(i)return r(i);this._writable.mkdir(t,e,r)})})}mkdirSync(t,e){if(this.checkInitialized(),this.existsSync(t))throw n.EEXIST(t);this.createParentDirectories(t),this._writable.mkdirSync(t,e)}readdir(t,e){this.checkInitAsync(e)&&this.stat(t,!1,(r,i)=>r?e(r):i.isDirectory()?void this._writable.readdir(t,(r,i)=>{if(r&&"ENOENT"!==r.code)return e(r);!r&&i||(i=[]),this._readable.readdir(t,(r,n)=>{!r&&n||(n=[]);const s={},o=i.concat(n.filter(e=>!this._deletedFiles[`${t}/${e}`])).filter(t=>{const e=!s[t];return s[t]=!0,e});e(null,o)})}):e(n.ENOTDIR(t)))}readdirSync(t){this.checkInitialized();const e=this.statSync(t,!1);if(!e.isDirectory())throw n.ENOTDIR(t);let r=[];try{r=r.concat(this._writable.readdirSync(t))}catch(t){}try{r=r.concat(this._readable.readdirSync(t).filter(e=>!this._deletedFiles[`${t}/${e}`]))}catch(t){}const i={};return r.filter(t=>{const e=!i[t];return i[t]=!0,e})}exists(t,e){this.checkInitialized(),this._writable.exists(t,r=>{if(r)return e(!0);this._readable.exists(t,r=>{e(r&&!0!==this._deletedFiles[t])})})}existsSync(t){return this.checkInitialized(),this._writable.existsSync(t)||this._readable.existsSync(t)&&!0!==this._deletedFiles[t]}chmod(t,e,r,i){this.checkInitAsync(i)&&this.operateOnWritableAsync(t,n=>{if(n)return i(n);this._writable.chmod(t,e,r,i)})}chmodSync(t,e,r){this.checkInitialized(),this.operateOnWritable(t,()=>{this._writable.chmodSync(t,e,r)})}chown(t,e,r,i,n){this.checkInitAsync(n)&&this.operateOnWritableAsync(t,s=>{if(s)return n(s);this._writable.chown(t,e,r,i,n)})}chownSync(t,e,r,i){this.checkInitialized(),this.operateOnWritable(t,()=>{this._writable.chownSync(t,e,r,i)})}utimes(t,e,r,i){this.checkInitAsync(i)&&this.operateOnWritableAsync(t,n=>{if(n)return i(n);this._writable.utimes(t,e,r,i)})}utimesSync(t,e,r){this.checkInitialized(),this.operateOnWritable(t,()=>{this._writable.utimesSync(t,e,r)})}deletePath(t){this._deletedFiles[t]=!0,this.updateLog(`d${t}\n`)}updateLog(t){this._deleteLog+=t,this._deleteLogUpdatePending?this._deleteLogUpdateNeeded=!0:(this._deleteLogUpdatePending=!0,this._writable.writeFile(l,this._deleteLog,"utf8",o.getFileFlag("w"),420,t=>{this._deleteLogUpdatePending=!1,t?this._deleteLogError=t:this._deleteLogUpdateNeeded&&(this._deleteLogUpdateNeeded=!1,this.updateLog(""))}))}_reparseDeletionLog(){this._deletedFiles={},this._deleteLog.split("\n").forEach(t=>{this._deletedFiles[t.slice(1)]="d"===t.slice(0,1)})}checkInitialized(){if(!this._isInitialized)throw new n(s.EPERM,"OverlayProvideris not initialized. Please initialize OverlayProviderusing its initialize() method before using it.");if(null!==this._deleteLogError){const t=this._deleteLogError;throw this._deleteLogError=null,t}}checkInitAsync(t){if(!this._isInitialized)return t(new n(s.EPERM,"OverlayProvideris not initialized. Please initialize OverlayProviderusing its initialize() method before using it.")),!1;if(null!==this._deleteLogError){const e=this._deleteLogError;return this._deleteLogError=null,t(e),!1}return!0}checkPath(t){if(t===l)throw n.EPERM(t)}checkPathAsync(t,e){return t===l&&(e(n.EPERM(t)),!0)}createParentDirectoriesAsync(e,r){let i=t.dirname(e);const o=[],a=this;this._writable.stat(i,!1,function e(c,l){c?"/"===i?r(new n(s.EBUSY,"Invariant failed: root does not exist!")):(o.push(i),i=t.dirname(i),a._writable.stat(i,!1,e)):function t(){if(!o.length)return r();const e=o.pop();a._readable.stat(e,!1,(i,n)=>{if(!n)return r();a._writable.mkdir(e,n.mode,e=>{if(e)return r(e);t()})})}()})}createParentDirectories(e){let r=t.dirname(e),i=[];for(;!this._writable.existsSync(r);)i.push(r),r=t.dirname(r);(i=i.reverse()).forEach(t=>{this._writable.mkdirSync(t,this.statSync(t,!1).mode)})}operateOnWritable(t,e){if(!this.existsSync(t))throw n.ENOENT(t);this._writable.existsSync(t)||this.copyToWritable(t),e()}operateOnWritableAsync(t,e){this.exists(t,r=>{if(!r)return e(n.ENOENT(t));this._writable.exists(t,r=>{if(!r)return this.copyToWritableAsync(t,e);e()})})}copyToWritable(t){const e=this.statSync(t,!1);e.isDirectory()?this._writable.mkdirSync(t,e.mode):this.writeFileSync(t,this._readable.readFileSync(t,null,u("r")),null,u("w"),this.statSync(t,!1).mode)}copyToWritableAsync(t,e){this.stat(t,!1,(r,i)=>r?e(r):i.isDirectory()?this._writable.mkdir(t,i.mode,e):void this._readable.readFile(t,null,u("r"),(r,n)=>{if(r)return e(r);this.writeFile(t,n,null,u("w"),i.mode,e)}))}}}),t("skylark-data-files/providers/overlay/overlay-provider",["skylark-langx-paths","../../files","../registry","../../stats","../../file-type","../../file-error","../../error-codes","../../file-flag","../../action-type","../locked-provider","./unlocked-overlay-provider"],function(t,e,r,i,n,s,o,a,c,l,h){class u extends l{constructor(t,e){super(new h(t,e))}static Create(t,e){try{const r=new u(t.writable,t.readable);r._initialize(t=>{e(t,r)})}catch(t){e(t)}}static isAvailable(){return h.isAvailable()}getOverlayedProviders(){return super.getFSUnlocked().getOverlayedProviders()}unwrap(){return super.getFSUnlocked()}_initialize(t){super.getFSUnlocked()._initialize(t)}}return u.Name="OverlayProvider",u.Options={writable:{type:"object",description:"The file system to write modified files to."},readable:{type:"object",description:"The file system that initially populates this file system."}},r.add("overlay",u),e.providers.OverlayProvider=u}),t("skylark-data-files/main",["./files","./action-type","./base-file","./error-codes","./error-strings","./file-error","./file-flag","./file-system","./no-sync-file","./preload-file","./stats","./configure","./providers/dropbox/dropbox-provider","./providers/html5/html5-lfs-provider","./providers/http/http-provider","./providers/indexeddb/indexed-db-provider","./providers/inmemory/in-memory-provider","./providers/localstorage/local-storage-provider","./providers/overlay/overlay-provider"],function(t){return t}),t("skylark-data-files",["skylark-data-files/main"],function(t){return t})}(r),!i){var o=require("skylark-langx-ns");n?module.exports=o:e.skylarkjs=o}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-data-files.js.map
