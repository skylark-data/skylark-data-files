/**
 * skylark-data-files - The skylark file system library
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx-paths","../stats","../file-type","./dir-inode","./file-inode"],function(t,e,i,n,s){"use strict";class r{constructor(){this._index={},this.addPath("/",new n)}static fromListing(t){const o=new r,d=new n;o._index["/"]=d;const h=[["",t,d]];for(;h.length>0;){let t;const r=h.pop(),d=r[0],a=r[1],l=r[2];for(const r in a)if(a.hasOwnProperty(r)){const u=a[r],c=`${d}/${r}`;u?(o._index[c]=t=new n,h.push([c,u,t])):t=new s(new e(i.FILE,-1,365)),l&&(l._ls[r]=t)}}return o}fileIterator(t){for(const e in this._index)if(this._index.hasOwnProperty(e)){const i=this._index[e],n=i.getListing();for(const e of n){const n=i.getItem(e);s.isFileInode(n)&&t(n.getData())}}}addPath(t,e){if(!e)throw new Error("Inode must be specified");if("/"!==t[0])throw new Error("Path must be absolute, got: "+t);if(this._index.hasOwnProperty(t))return this._index[t]===e;const i=this._split_path(t),s=i[0],r=i[1];let o=this._index[s];return!(void 0===o&&"/"!==t&&(o=new n,!this.addPath(s,o)))&&(!("/"!==t&&!o.addItem(r,e))&&(n.isDirInode(e)&&(this._index[t]=e),!0))}addPathFast(t,e){const i=t.lastIndexOf("/"),s=0===i?"/":t.substring(0,i),r=t.substring(i+1);let o=this._index[s];return void 0===o&&(o=new n,this.addPathFast(s,o)),!!o.addItem(r,e)&&(e.isDir()&&(this._index[t]=e),!0)}removePath(t){const e=this._split_path(t),i=e[0],s=e[1],r=this._index[i];if(void 0===r)return null;const o=r.remItem(s);if(null===o)return null;if(n.isDirInode(o)){const e=o.getListing();for(const i of e)this.removePath(t+"/"+i);"/"!==t&&delete this._index[t]}return o}ls(t){const e=this._index[t];return void 0===e?null:e.getListing()}getInode(t){const e=this._split_path(t),i=e[0],n=e[1],s=this._index[i];return void 0===s?null:i===t?s:s.getItem(n)}_split_path(e){const i=t.dirname(e);return[i,e.substr(i.length+("/"===i?0:1))]}}return r});
//# sourceMappingURL=../sourcemaps/inodes/file-index.js.map
