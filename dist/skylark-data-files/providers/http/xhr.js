/**
 * skylark-data-files - The skylark file system library
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx-binary/buffer","../../error-codes","../../file-error","../../utils"],function(e,n,t,r){"use strict";const{isIE:s,emptyBuffer:o}=r;function a(e,r,s){const o=new XMLHttpRequest;o.open("HEAD",r,e),o.onreadystatechange=function(e){if(4===o.readyState){if(200!==o.status)return s(new t(n.EIO,`XHR HEAD error: response returned code ${o.status}`));try{return s(null,parseInt(o.getResponseHeader("Content-Length")||"-1",10))}catch(e){return s(new t(n.EIO,"XHR HEAD error: Could not read content-length."))}}},o.send()}return{xhrIsAvailable:"undefined"!=typeof XMLHttpRequest&&null!==XMLHttpRequest,asyncDownloadFile:function(r,s,a){const u=new XMLHttpRequest;u.open("GET",r,!0);let c=!0;switch(s){case"buffer":u.responseType="arraybuffer";break;case"json":try{u.responseType="json",c="json"===u.responseType}catch(e){c=!1}break;default:return a(new t(n.EINVAL,"Invalid download type: "+s))}u.onreadystatechange=function(r){if(4===u.readyState){if(200!==u.status)return a(new t(n.EIO,`XHR error: response returned code ${u.status}`));switch(s){case"buffer":return a(null,u.response?e.from(u.response):o());case"json":return a(null,c?u.response:JSON.parse(u.responseText))}}},u.send()},syncDownloadFile:s&&"undefined"!=typeof Blob?function(r,s){const o=new XMLHttpRequest;switch(o.open("GET",r,!1),s){case"buffer":o.responseType="arraybuffer";break;case"json":break;default:throw new t(n.EINVAL,"Invalid download type: "+s)}let a,u;if(o.onreadystatechange=function(r){if(4===o.readyState)if(200===o.status)switch(s){case"buffer":a=e.from(o.response);break;case"json":a=JSON.parse(o.response)}else u=new t(n.EIO,`XHR error: response returned code ${o.status}`)},o.send(),u)throw u;return a}:function(r,s){const o=new XMLHttpRequest;o.open("GET",r,!1);let a=null,u=null;if(o.overrideMimeType("text/plain; charset=x-user-defined"),o.onreadystatechange=function(r){if(4===o.readyState){if(200!==o.status)return void(u=new t(n.EIO,`XHR error: response returned code ${o.status}`));switch(s){case"buffer":const n=o.responseText;a=e.alloc(n.length);for(let e=0;e<n.length;e++)a[e]=n.charCodeAt(e);return;case"json":return void(a=JSON.parse(o.responseText))}}},o.send(),u)throw u;return a},getFileSizeSync:function(e){let n=-1;return a(!1,e,function(e,t){if(e)throw e;n=t}),n},getFileSizeAsync:function(e,n){a(!0,e,n)}}});
//# sourceMappingURL=../../sourcemaps/providers/http/xhr.js.map
