/**
 * skylark-data-files - The skylark file system library
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx-binary/buffer","skylark-langx-paths","../files","../error-codes","../file-error","../action-type","../file-flag","../utils"],function(n,t,e,r,i,c,s,o){"use strict";const{fail:l}=o;return e.providers.BaseProvider=class{supportsLinks(){return!1}diskSpace(n,t){t(0,0)}openFile(n,t,e){throw new i(r.ENOTSUP)}createFile(n,t,e,c){throw new i(r.ENOTSUP)}open(n,e,s,o){this.stat(n,!1,(a,S)=>{if(a)switch(e.pathNotExistsAction()){case c.CREATE_FILE:return this.stat(t.dirname(n),!1,(r,c)=>{r?o(r):c&&!c.isDirectory()?o(i.ENOTDIR(t.dirname(n))):this.createFile(n,e,s,o)});case c.THROW_EXCEPTION:return o(i.ENOENT(n));default:return o(new i(r.EINVAL,"Invalid FileFlag object."))}else{if(S&&S.isDirectory())return o(i.EISDIR(n));switch(e.pathExistsAction()){case c.THROW_EXCEPTION:return o(i.EEXIST(n));case c.TRUNCATE_FILE:return this.openFile(n,e,(n,t)=>{n?o(n):t?t.truncate(0,()=>{t.sync(()=>{o(null,t)})}):l()});case c.NOP:return this.openFile(n,e,o);default:return o(new i(r.EINVAL,"Invalid FileFlag object."))}}})}rename(n,t,e){e(new i(r.ENOTSUP))}renameSync(n,t){throw new i(r.ENOTSUP)}stat(n,t,e){e(new i(r.ENOTSUP))}statSync(n,t){throw new i(r.ENOTSUP)}openFileSync(n,t,e){throw new i(r.ENOTSUP)}createFileSync(n,t,e){throw new i(r.ENOTSUP)}openSync(n,e,s){let o;try{o=this.statSync(n,!1)}catch(o){switch(e.pathNotExistsAction()){case c.CREATE_FILE:if(!this.statSync(t.dirname(n),!1).isDirectory())throw i.ENOTDIR(t.dirname(n));return this.createFileSync(n,e,s);case c.THROW_EXCEPTION:throw i.ENOENT(n);default:throw new i(r.EINVAL,"Invalid FileFlag object.")}}if(o.isDirectory())throw i.EISDIR(n);switch(e.pathExistsAction()){case c.THROW_EXCEPTION:throw i.EEXIST(n);case c.TRUNCATE_FILE:return this.unlinkSync(n),this.createFileSync(n,e,o.mode);case c.NOP:return this.openFileSync(n,e,s);default:throw new i(r.EINVAL,"Invalid FileFlag object.")}}unlink(n,t){t(new i(r.ENOTSUP))}unlinkSync(n){throw new i(r.ENOTSUP)}rmdir(n,t){t(new i(r.ENOTSUP))}rmdirSync(n){throw new i(r.ENOTSUP)}mkdir(n,t,e){e(new i(r.ENOTSUP))}mkdirSync(n,t){throw new i(r.ENOTSUP)}readdir(n,t){t(new i(r.ENOTSUP))}readdirSync(n){throw new i(r.ENOTSUP)}exists(n,t){this.stat(n,null,function(n){t(!n)})}existsSync(n){try{return this.statSync(n,!0),!0}catch(n){return!1}}realpath(n,e,r){if(this.supportsLinks()){const e=n.split(t.sep);for(let n=0;n<e.length;n++){const r=e.slice(0,n+1);e[n]=t.join.apply(null,r)}}else this.exists(n,function(t){t?r(null,n):r(i.ENOENT(n))})}realpathSync(n,e){if(this.supportsLinks()){const e=n.split(t.sep);for(let n=0;n<e.length;n++){const r=e.slice(0,n+1);e[n]=t.join.apply(path,r)}return e.join(t.sep)}if(this.existsSync(n))return n;throw i.ENOENT(n)}truncate(n,t,e){this.open(n,s.getFileFlag("r+"),420,function(n,r){if(n)return e(n);r.truncate(t,function(n){r.close(function(t){e(n||t)})})})}truncateSync(n,t){const e=this.openSync(n,s.getFileFlag("r+"),420);try{e.truncateSync(t)}catch(n){throw n}finally{e.closeSync()}}readFile(n,t,e,r){const i=r;this.open(n,e,420,(n,e)=>{if(n)return r(n);r=function(n,t){e.close(function(e){return n||(n=e),i(n,t)})},e.stat((n,i)=>{if(n)return r(n);const c=Buffer.alloc(i.size);e.read(c,0,i.size,0,n=>{if(n)return r(n);if(null===t)return r(n,c);try{r(null,c.toString(t))}catch(n){r(n)}})})})}readFileSync(n,t,e){const r=this.openSync(n,e,420);try{const n=r.statSync(),e=Buffer.alloc(n.size);return r.readSync(e,0,n.size,0),r.closeSync(),null===t?e:e.toString(t)}finally{r.closeSync()}}writeFile(n,t,e,r,i,c){const s=c;this.open(n,r,420,function(n,r){if(n)return c(n);c=function(n){r.close(function(t){s(n||t)})};try{"string"==typeof t&&(t=Buffer.from(t,e))}catch(n){return c(n)}r.write(t,0,t.length,0,c)})}writeFileSync(n,t,e,r,i){const c=this.openSync(n,r,i);try{"string"==typeof t&&(t=Buffer.from(t,e)),c.writeSync(t,0,t.length,0)}finally{c.closeSync()}}appendFile(n,t,e,r,i,c){const s=c;this.open(n,r,i,function(n,r){if(n)return c(n);c=function(n){r.close(function(t){s(n||t)})},"string"==typeof t&&(t=Buffer.from(t,e)),r.write(t,0,t.length,null,c)})}appendFileSync(n,t,e,r,i){const c=this.openSync(n,r,i);try{"string"==typeof t&&(t=Buffer.from(t,e)),c.writeSync(t,0,t.length,null)}finally{c.closeSync()}}chmod(n,t,e,c){c(new i(r.ENOTSUP))}chmodSync(n,t,e){throw new i(r.ENOTSUP)}chown(n,t,e,c,s){s(new i(r.ENOTSUP))}chownSync(n,t,e,c){throw new i(r.ENOTSUP)}utimes(n,t,e,c){c(new i(r.ENOTSUP))}utimesSync(n,t,e){throw new i(r.ENOTSUP)}link(n,t,e){e(new i(r.ENOTSUP))}linkSync(n,t){throw new i(r.ENOTSUP)}symlink(n,t,e,c){c(new i(r.ENOTSUP))}symlinkSync(n,t,e){throw new i(r.ENOTSUP)}readlink(n,t){t(new i(r.ENOTSUP))}readlinkSync(n){throw new i(r.ENOTSUP)}}});
//# sourceMappingURL=../sourcemaps/providers/base-provider.js.map
